(function(h,z){var x=BPLR.Util;h.$bp.Prebid=BPLR.Abstract.extend({bidding:!1,timeout:2E3,refreshTime:0,refreshingBids:!1,refreshingTimeouts:[],midrollBidding:!1,midrollLastBiddedCuepoint:null,allowScroll:!1,adUnits:[],backfillAdUnits:[],adUnitBidLength:0,bidCounter:0,backfillBidCounter:0,schainData:null,schainDataBackfill:null,userPrebidFinished:!1,playbackOccurred:!1,analyticsEventSet:!1,prebidConfig:{},init:function d(a,b){d.base.call(this,a,b);if(a.config.Prebid)var e=a.config.Prebid;a.prebidConfig&&
(e=a.prebidConfig);e&&(this.prebidConfig.prebid_variable=e.prebid_variable,this.prebidConfig.js_file=e.js_file,this.prebidConfig.adunit_codes=e.adunit_codes,this.prebidConfig.sellers_file=e.sellers_file,this.prebidConfig.global_config=e.global_config,this.prebidConfig.bidder_settings=e.bidder_settings,this.prebidConfig.dont_use_dfp=e.dont_use_dfp?e.dont_use_dfp:!1,this.prebidConfig.prebid_ad_unit_width=e.prebid_ad_unit_width,this.prebidConfig.prebid_ad_unit_height=e.prebid_ad_unit_height);a.config.Prebid&&
a.config.Prebid.global_config&&a.config.Prebid.global_config.prebid_variable&&(a.config.Prebid.prebid_variable=a.config.Prebid.global_config.prebid_variable,this.prebidConfig.prebid_variable=a.config.Prebid.global_config.prebid_variable,delete a.config.Prebid.global_config.prebid_variable);a.prebidConfig&&a.prebidConfig.global_config&&a.prebidConfig.global_config.prebid_variable&&(this.prebidConfig.prebid_variable=a.prebidConfig.global_config.prebid_variable,delete a.prebidConfig.global_config.prebid_variable);
a.config.prebid_variable&&(a.config.Prebid.prebid_variable=a.config.prebid_variable,this.prebidConfig.prebid_variable=a.config.prebid_variable);a.config.Prebid&&a.config.Prebid.global_config&&a.config.Prebid.global_config.prebid_timeout&&(this.timeout=parseInt(a.config.Prebid.global_config.prebid_timeout),delete a.config.Prebid.global_config.prebid_timeout);a.prebidConfig&&a.prebidConfig.global_config&&a.prebidConfig.global_config.timeout&&(this.timeout=parseInt(a.prebidConfig.global_config.timeout));
a.config.prebid_timeout&&(this.timeout=parseInt(a.config.prebid_timeout));a.config.prebid_bid_refresh_time&&(this.refreshTime=parseInt(a.config.prebid_bid_refresh_time));a.config.Prebid&&(this.adUnits=this.generateAdUnits(a.config.Prebid.adunit_codes||a.config.Prebid));a.config.AdSchedule&&(this.adUnits=this.generateNewAdUnits(a.config.AdSchedule));BPLR.log("Prebid adUnits",this.adUnits);this.player.config.Partner.program&&this.player.config.Partner.program.Prebid&&(this.backfillAdUnits=this.generateBackfillAdUnits(a.config.Partner.program.Prebid));
BPLR.log("Prebid backfillAdUnits",this.backfillAdUnits);(this.player.prebidConfig&&(this.player.prebidConfig.js_file||this.player.prebidConfig.adunit_codes)&&0!=this.adUnits.length||this.player.config.Prebid&&(this.player.config.Prebid.js_file||this.player.config.Prebid.adunit_codes)&&0!=this.adUnits.length||this.player.config.Partner.program&&this.player.config.Partner.program.Prebid)&&-1==x.getEmbededUrl().indexOf("#BPLRNoPrebid")&&a.config.monetize?(this.schainData=x.getSchain(this.player,BPLR.Util.$f(this,
this.onSellersLoad)),this.waitingForSellersFile=!1===this.schainData,this.player.config.Partner.program&&this.player.config.Partner.program.Prebid&&this.player.config.Partner.program.Prebid.schain&&(this.schainDataBackfill=this.player.config.Partner.program.Prebid.schain),this.player.add(["nextVideo","skipped"],this.$f(this.onNextVideo)),this.player.addOnce("playCalledDuringBidding",this.$f(this.onPlayCalledDuringBidding)),this.adUnits.some(function(c){return"midroll"==c.type})&&0==this.player.config.auto_skip_at&&
(BPLR.log("Prebid prepare to bid for midrolls during playback"),this.player.add("timeupdate",this.$f(this.onTimeupdate))),BPLR.isMobilePlatform&&a.config.autoplay&&(BPLR.log("Prebid set muted for mobile"),a.muted(!0)),this.hasPbjs()?(this.getPbjs("pbjs"),this.prebidConfig&&this.prebidConfig.adunit_codes||this.player.config.Partner.program&&this.player.config.Partner.program.Prebid&&this.player.config.Partner.program.Prebid.adunit_codes?(BPLR.log("Prebid JS found on page, waiting for adunits:",this.adUnits),
a.add("ready",this.$f(this.waitForAdUnit))):(BPLR.log("Prebid JS found on page, ignoring JS set in CMS"),a.add("ready",this.$f(this.prebidReady)))):this.prebidConfig&&!this.prebidConfig.js_file?a.config.prebid_wait_time&&this.player.prebidConfig.adunit_codes?this.waitForPrebidOnPageToBecomeAvailable():(BPLR.log("Prebid not found on page and JS file not specified, exiting..."),this.allowScroll=!0):(this.getPbjs(),a=[],this.prebidConfig&&this.prebidConfig.js_file&&a.push(this.prebidConfig.js_file),
this.player.config.Partner.program&&this.player.config.Partner.program.Prebid&&a.push(this.player.config.Partner.program.Prebid.js_file),BPLR.Loader.load("js",a,this.$f(this.prebidReady),null,this))):(BPLR.log("Prebid not valid unit config found, returning..."),this.allowScroll=!0)},prebidReady:function(){BPLR.log("Prebid ready, bid_preload",this.player.config.bid_preload);this.prebidReadyFired=!0;(this.player.config.bid_preload||this.playCalled)&&this.runBidding()},onPlayCalledDuringBidding:function(){this.playCalled=
!0;!this.player.config.bid_preload&&this.prebidReadyFired&&this.runBidding()},onTimeupdate:function(){var a=this.player,b=this.player.adsManager,d=b.getScheduledCuepoints();if(d&&d.length&&!this.bidding&&!a.getAdInProgress()&&!a.waitingForAd&&(this.midrollLastBiddedCuepoint||(this.midrollLastBiddedCuepoint=d[0]),!(1>a.currentTime()-this.midrollLastBiddedCuepoint)&&d[0]!=this.midrollLastBiddedCuepoint&&(this.midrollLastBiddedCuepoint=d[0],a=this.adUnits.filter(function(e){return"midroll"==e.type}),
0<a.length))){BPLR.log("Prebid start bidding for midroll at cuepoint ",this.midrollLastBiddedCuepoint);for(d=0;d<b.ads.midroll.adTags.length;d++)b.ads.midroll.adTags[d]=b.ads.midroll.adTags[d].filter(function(e){return"prebid"!=e.source&&"combined"!=e.source});this.midrollBidding=!0;this.runBidding(a)}},runBidding:function(a){var b=this.player,d=this;a=a&&a[0]?a:this.adUnits;this.adUnitBidLength=a.length;this.bidding||this.waitingForSellersFile||(b.adsManager&&b.adsManager.checkOffsetAndFrequency()?
(this.bidding=!0,Promise.all([this.runCMSPrebid(a),this.runBackfillPrebid()]).then(function(e){"PLAYBACK"==e[0]&&"PLAYBACK"==e[1]?d.playback():d.allBidsFinished("TESTIS")})):this.playback())},runCMSPrebid:function(a){var b=this,d=this.player,e=a&&a[0]?a:this.adUnits,c=this.prebidConfig,k=z.BPLRIframeBurst?h.top:h;return new Promise(function(f,g){if(0==e.length)f("PLAYBACK");else try{b.auctionIds=[];b.bidCounter=0;b.getPbjs("pbjs");b.checkAliases(e);if(c.bidder_settings)try{var m=(new Function("return "+
c.bidder_settings))();"object"==typeof m&&(b.pbjs.bidderSettings=m,BPLR.log("Prebid setting bidder_settings"))}catch(l){BPLR.log("Prebid error parsing bidder_settings",l)}e.forEach(function(l){l.bids=b.replaceMacros(l.bids);var t={code:l.id,mediaTypes:{video:{playerSize:h.prebidPlayerSizeBPLR?b.getClosestPlayerSize(h.prebidPlayerSizeBPLR):c.prebid_ad_unit_width&&c.prebid_ad_unit_height?[parseInt(c.prebid_ad_unit_width),parseInt(c.prebid_ad_unit_height)]:BPLR.isMobilePlatform?[400,300]:[640,480],context:d.currentSrc()?
"instream":"outstream"}},bids:l.bids},v=b.generateAuctionId();l.media_types&&x.merge(t.mediaTypes.video,l.media_types);BPLR.log("Prebid setting request",t,"auctionId",v);b.pbjs.que.push(function(){var u=h.prebidConfigBPLR||c.global_config||{cache:{url:"https://prebid.adnxs.com/pbc/v1/cache"},priceGranularity:"auto",userSync:{iframeEnabled:!0,filterSettings:{iframe:{bidders:"*",filter:"include"}}}};b.schainData&&(u.schain=b.schainData);b.pbjs.adUnits.some(function(n){return n.code==l.id})||(BPLR.log("Prebid addAdUnits",
l.id,"config",u),b.pbjs.addAdUnits(t));"function"===typeof k.__tcfapi?u.consentManagement||(u.consentManagement={gdpr:{timeout:5E3,defaultGdprScope:!0},usp:{timeout:5E3}}):u.consentManagement&&delete u.consentManagement;b.pbjs.setConfig(u);"undefined"!=typeof h.bidderSettingsBPLR&&(b.pbjs.bidderSettings=h.bidderSettingsBPLR);"undefined"!=typeof h.prebidAnalyticsConfigBPLR&&b.pbjs.enableAnalytics(h.prebidAnalyticsConfigBPLR);b.auctionIds.push(v);b.pbjs.requestBids({adUnitCodes:[l.id],auctionId:v,timeout:b.timeout,
bidsBackHandler:function(n,q,p){BPLR.log("Prebid bidsBackHandler unit.id",l.id,"auctionId",p,"bids",n);if(b.auctionIds.includes(p))if(n[l.id]){p=!1;for(var r=n[l.id].bids.length-1;0<=r;r--){var y=n[l.id].bids[r];(q=t.bids.find(function(w){return w.bidder==y.bidderCode}))&&q.floor_price&&(q=parseFloat(q.floor_price),y.cpm<q&&(BPLR.log("Prebid removing",y.bidderCode,"cpm",y.cpm,"floorPrice",q),n[l.id].bids.splice(r,1),p=!0))}q=n[l.id].bids.slice().sort(function(w,A){return A.cpm-w.cpm})[0];for(r=n[l.id].bids.length-
1;0<=r;r--)q.bidder==n[l.id].bids[r].bidderCode&&(n[l.id].bids[r].bidWon=!0),b.player.trigger("bidderResponse",n[l.id].bids[r]);if(p){p=n[l.id].bids.slice().sort(function(w,A){return w.cpm-A.cpm}).pop();if(!p){BPLR.log("Prebid no bids after applying floorPrice!");b.bidReturned().then(function(w){"PREBID_ALL_FINISHED"==w&&f("runCMSPrebid DONE")});return}p=b.buildVideoUrl(t,l,q,p)}else p=b.buildVideoUrl(t,l,q,null);p=p.replace(/%5B((brid|item|bplr?)[_-][a-zA-Z0-9_]+?)%5D/g,"[$1]");BPLR.log("Prebid vastUrl",
p);r={unitId:l.id,unitIu:l.iu,bidder:q.bidder,cpm:q.cpm,timestamp:Date.now()};0<n[l.id].bids.length&&b.player.trigger("bidWon",r);BPLR.log("Prebid BIDS LENGTH",n[l.id].bids.length,n[l.id].bids[0].bidder,q.bidder,q.cpm);b.bidReturned(l,p,r).then(function(w){"PREBID_ALL_FINISHED"==w&&f("runCMSPrebid DONE")})}else BPLR.log("Prebid bids don't have response for brid_video unit"),b.bidReturned().then(function(w){"PREBID_ALL_FINISHED"==w&&f("runCMSPrebid DONE")});else BPLR.log("Prebid ignore auctionId",
p),f("PLAYBACK")}})})},this)}catch(l){BPLR.log("Prebid error occurred, going to playback...",l),f("PLAYBACK")}})},runBackfillPrebid:function(){var a=this.backfillAdUnits,b=this,d=this.player,e=d.config.Partner.program&&d.config.Partner.program.Prebid,c=z.BPLRIframeBurst?h.top:h;BPLR.log("Prebid runBackfillPrebid",this.refreshingBids);return new Promise(function(k,f){if(0==a.length)k("PLAYBACK");else if(b.refreshingBids)k("REFERSH");else{b.player.config.Partner.program.backfill_prebid=[];try{b.backfillBidCounter=
0,b.backfillAuctionIds=[],b.getBackfillPbjs(e.prebid_variable),b.checkAliases(a),a.forEach(function(g){g.bids=b.replaceMacros(g.bids);var m={code:g.id,mediaTypes:{video:{playerSize:h.prebidPlayerSizeBPLR?b.getClosestPlayerSize(h.prebidPlayerSizeBPLR):e.prebid_ad_unit_width&&e.prebid_ad_unit_height?[parseInt(e.prebid_ad_unit_width),parseInt(e.prebid_ad_unit_height)]:BPLR.isMobilePlatform?[400,300]:[640,480],context:d.currentSrc()?"instream":"outstream"}},bids:g.bids},l=b.generateAuctionId();g.media_types&&
x.merge(m.mediaTypes.video,g.media_types);BPLR.log("Backfill Prebid setting request",m,"auctionId",l);b.pbjsBackfill.que.push(function(){var t=h.prebidConfigBPLR||e.global_config||{cache:{url:"https://prebid.adnxs.com/pbc/v1/cache"},priceGranularity:"auto"};b.schainDataBackfill&&(t.schain=b.schainDataBackfill);b.pbjsBackfill.adUnits.some(function(v){return v.code==g.id})||(BPLR.log("Backfill Prebid addAdUnits",g.id,"config",t),b.pbjsBackfill.addAdUnits(m));"function"===typeof c.__tcfapi?t.consentManagement||
(t.consentManagement={gdpr:{timeout:5E3,defaultGdprScope:!0},usp:{timeout:5E3}}):t.consentManagement&&delete t.consentManagement;b.pbjsBackfill.setConfig(t);"undefined"!=typeof h.bidderSettingsBPLR&&(b.pbjsBackfill.bidderSettings=h.bidderSettingsBPLR);b.backfillAuctionIds.push(l);b.pbjsBackfill.requestBids({adUnitCodes:[g.id],auctionId:l,bidsBackHandler:function(v,u,n){BPLR.log("Backfill Prebid bidsBackHandler unit.id",g.id,"auctionId",n,"bids",v);if(b.backfillAuctionIds.includes(n))if(v[g.id]){u=
v[g.id].bids.slice().sort(function(p,r){return r.cpm-p.cpm})[0];n=b.backfillBuildVideoUrl(m,g,u,null);n=n.replace(/%5B((brid|bplr?)_[a-zA-Z0-9_]+?)%5D/g,"[$1]");BPLR.log("Backfill Prebid vastUrl",n);var q={unitId:g.id,unitIu:g.iu,bidder:u.bidder,cpm:u.cpm,timestamp:Date.now()};BPLR.log("Backfill rebid BIDS LENGTH",v[g.id].bids.length,v[g.id].bids[0].bidder,u.bidder,u.cpm);b.backfillBidReturned(g,n,q).then(function(p){"BACKFILL_PREBID_ALL_FINISHED"==p&&k("runBackfillPrebid DONE")})}else BPLR.log("Backfill prebid bids don't have response for brid_video unit"),
b.backfillBidReturned().then(function(p){"BACKFILL_PREBID_ALL_FINISHED"==p&&k("runBackfillPrebid DONE")});else BPLR.log("Backfill Prebid ignore auctionId",n),k("PLAYBACK")}})})},this)}catch(g){BPLR.log("Backfill Prebid error occurred, going to playback...",g),k("PLAYBACK")}}})},bidReturned:function(a,b,d){if(b){var e=this.prebidConfig;("string"==typeof b?[b]:b).forEach(function(c){e.prebid_ad_unit_width&&e.prebid_ad_unit_height&&(c=c.replace(/&sz=\d+x\d+/g,"&sz="+e.prebid_ad_unit_width+"x"+e.prebid_ad_unit_height));
var k={adTagUrl:c,adType:this.getAdType(a.type),adTimeType:"s",overlayStartAt:null,overlayDuration:null,pod:a.id.replace(/^.*-/,""),source:"prebid",cpm:d.cpm,data:d};a.ad_source_id&&(k.id=a.ad_source_id,k.sc=a.sc_id);this.nonstopBiddingStarted?this.nonstopBiddingAds.push(k):this.refreshingBids||this.midrollBidding?(BPLR.log("Prebid replacePrebidTag",c,"unit id",a.id,"ad object",k),this.player.Advertising.replacePrebidTag(k)):(BPLR.log("Prebid setAd",c,"unit id",a.id,"ad object",k),this.player.setAd(k,
!0,null,!0))}.bind(this))}this.bidCounter++;BPLR.log("Prebid checking counts adUnits length",this.adUnitBidLength,"counter",this.bidCounter);return this.bidCounter==this.adUnitBidLength?Promise.resolve("PREBID_ALL_FINISHED"):Promise.resolve("bidCounter: "+this.bidCounter+" || adUnits length: "+this.adUnitBidLength)},backfillBidReturned:function(a,b,d){if(b){var e=this.player.config.Partner.program.Prebid;("string"==typeof b?[b]:b).forEach(function(c){e.prebid_ad_unit_width&&e.prebid_ad_unit_height&&
(c=c.replace(/&sz=\d+x\d+/g,"&sz="+e.prebid_ad_unit_width+"x"+e.prebid_ad_unit_height));c+="&tfcd=0&description_url=[description_url]&npa=0";"BPLR.Player"==this.player.name&&(c+="&vid_t=[video_title]&vid_d=[video_duration]&vid_kw=[video_tags]");var k={adTagUrl:c,adType:this.getAdType(a.type),adTimeType:"s",overlayStartAt:null,overlayDuration:null,pod:a.id.replace(/^.*-/,""),source:"prebid",data:d};BPLR.log("Backfill Prebid setAd",c,"unit id",a.id,"ad object",k);this.player.setBackfillAd(k)}.bind(this))}this.backfillBidCounter++;
BPLR.log("Backfill Prebid checking counts adUnits length",this.backfillAdUnits.length,"counter",this.backfillBidCounter);return this.backfillBidCounter==this.backfillAdUnits.length?Promise.resolve("BACKFILL_PREBID_ALL_FINISHED"):Promise.resolve("backfillBidCounter: "+this.backfillBidCounter+"|| backfillAdUnits length: "+this.backfillAdUnits.length)},allBidsFinished:function(a){BPLR.log("Prebid allBidsFinished call...",a);BPLR.log("Prebid all bids returned");this.bidding=!1;if(0<this.refreshTime&&
(this.refreshingTimeouts[Date.now()]=setTimeout(this.$f(this.checkExpiredBids),1E3*this.refreshTime),this.refreshingBids)){this.refreshingBids=!1;BPLR.log("Prebid allBidsFinished call...","refresh return");return}this.midrollBidding||this.player.adsManager.checkScheduledAds();this.playback()},playback:function(){this.midrollBidding?this.midrollBidding=!1:this.playbackOccurred||(BPLR.log("Prebid playback",this.player.config.autoplay,this.player.values.playCalled,this.playCalled),this.bidding=!1,this.playbackOccurred=
this.allowScroll=!0,this.player.values.playCalled||this.playCalled?this.player.play():this.player.config.autoplay&&(this.player.config.autoplayInview?(this.player.isPlayerInView()||"BPLR.OSPlayer"==this.player.name)&&this.player.play():this.player.play()))},waitForPrebidOnPageToBecomeAvailable:function(){BPLR.log("Prebid waiting for variable to load, timeout",this.player.config.prebid_wait_time);var a=Date.now()+this.player.config.prebid_wait_time,b=setInterval(function(){this.hasPbjs()?(this.getPbjs("pbjs"),
BPLR.log("Prebid JS found on page, waiting for adunits:",this.adUnits,"player ready",this.player.isReady),this.player.isReady?this.waitForAdUnit():this.player.add("ready",this.$f(this.waitForAdUnit)),clearInterval(b)):Date.now()>a&&(BPLR.log("Prebid not found on page even after timeout, exiting..."),this.playback(),clearInterval(b))}.bind(this),50)},waitForAdUnit:function(){var a=this;setTimeout(this.$f(function(){BPLR.log("Prebid timeout occurred - waitForAdUnit",this.userPrebidFinished);this.userPrebidFinished||
this.playback()}),this.timeout);this.pbjs.que.push(function(){a.pbjs.onEvent("auctionEnd",function(b){BPLR.log("Prebid auctionEnded",b);setTimeout(a.$f(function(){a.checkVideoBidBack(b)}),500)})});this.checkVideoBidBack()},checkVideoBidBack:function(a){if(!this.playbackOccurred&&!this.biddingFinished){var b=this,d=[],e=h.videoUnit||h.videoUnits||h.adUnit||h.adUnits||[];d=d.concat(Array.isArray(e)?e:[e]);BPLR.log("Prebid checking the following adUnits for vastUrl",d,"auctionEndData",a);0==d.length?
BPLR.log("Prebid adUnits empty"):(d.map(function(c){this.adUnits.forEach(function(k){if(c.code==k.code&&c.vastUrl){var f=a&&a.bidsReceived.find(function(g){return g.adUnitCode==k.code})||{};this.bidReturned(k,c.vastUrl,f).then(function(g){BPLR.log("Prebid checkVideoBidBack bidReturned message",g)}.bind(this));b.userPrebidFinished=!0}},this)},this),this.userPrebidFinished&&this.allBidsFinished("User Prebid"))}},generateNewAdUnits:function(a){var b=this,d=[];x.each(["preroll","midroll","postroll"],
function(e){a[e]&&x.each(a[e],function(c,k){if(c.mobile||c.desktop){if(!BPLR.isMobilePlatform&&c.desktop)var f=c.desktop.adSources;else c.mobile&&(f=c.mobile.adSources);x.each(f,function(g){if(g.Prebid){var m=x.merge({},g.Prebid);m.pod=k;m.ad_source_id=m.id;m.sc_id=a.id;!BPLR.isMobilePlatform&&g.Prebid.desktop?(m.bids=g.Prebid.desktop.bids,m.custom_params=g.Prebid.desktop.custom_params,m.iu=g.Prebid.desktop.iu,m.media_types=g.Prebid.desktop.media_types):g.Prebid.mobile&&(m.bids=g.Prebid.mobile.bids,
m.custom_params=g.Prebid.mobile.custom_params,m.iu=g.Prebid.mobile.iu,m.media_types=g.Prebid.mobile.media_types);m=b.replaceMacros(m);m.id="bplr-"+e+"-"+(void 0!=m.pod?m.pod:k);m.type=e;m.index=k;d.push(m)}})}})});return d},generateAdUnits:function(a){var b=this,d=[];["preroll","midroll","postroll"].forEach(function(e){a[e]&&(Array.isArray(a[e])||(a[e]=[a[e]]),a[e].forEach(function(c,k){if(c.mobile||c.desktop)!BPLR.isMobilePlatform&&c.desktop?(c.bids=c.desktop.bids,c.custom_params=c.desktop.custom_params,
c.iu=c.desktop.iu,c.media_types=c.desktop.media_types):c.mobile&&(c.bids=c.mobile.bids,c.custom_params=c.mobile.custom_params,c.iu=c.mobile.iu,c.media_types=c.mobile.media_types),c=b.replaceMacros(c);c.media_types&&c.media_types.playerSize&&(c.media_types.playerSize=b.getClosestPlayerSize(c.media_types.playerSize));if(c.bids)for(var f=c.bids.length-1;0<=f;f--)if("ix"==c.bids[f].bidder&&c.bids[f].params&&c.bids[f].params.size&&(c.bids[f].params.size=b.getClosestPlayerSize(c.bids[f].params.size)),c.bids[f].domain_list_type&&
c.bids[f].domain_list){var g=x.isOnDomain(c.bids[f].domain_list);if("whitelist"==c.bids[f].domain_list_type&&!g||"blacklist"==c.bids[f].domain_list_type&&g)BPLR.log("Prebid removing",c.bids[f].bidder,"type",c.bids[f].domain_list_type,"list",c.bids[f].domain_list,"onDomain",g),c.bids.splice(f,1)}c.id="bplr-"+e+"-"+(void 0!=c.pod?c.pod:k);c.type=e;c.index=k;(c.bids&&0<c.bids.length||c.code)&&d.push(c)}))});return d},generateBackfillAdUnits:function(a){var b=this,d=[];this.player.config.Ad.forEach(function(e){var c=
"0"==e.adType?"preroll":"1"==e.adType?"midroll":"postroll";e=!BPLR.isMobilePlatform&&e.desktop?e.desktop.length:e.mobile?e.mobile.length:0;for(var k=0;k<e;k++){var f=a;if(a.mobile||a.desktop)!BPLR.isMobilePlatform&&a.desktop?(f.bids=a.desktop.bids,f.custom_params=a.desktop.custom_params,f.iu=a.desktop.iu,f.media_types=a.desktop.media_types):a.mobile&&(f.bids=a.mobile.bids,f.custom_params=a.mobile.custom_params,f.iu=a.mobile.iu,f.media_types=a.mobile.media_types),f=b.replaceMacros(f);f.media_types&&
f.media_types.playerSize&&(f.media_types.playerSize=b.getClosestPlayerSize(f.media_types.playerSize));if(f.bids)for(var g=f.bids.length-1;0<=g;g--)"ix"==f.bids[g].bidder&&f.bids[g].params&&f.bids[g].params.size&&(f.bids[g].params.size=b.getClosestPlayerSize(f.bids[g].params.size));f.id="bplr-backfill-"+c+"-"+k;f.type=c;f.index=k;(f.bids&&0<f.bids.length||f.code)&&d.push(f)}});return d},backfillBuildVideoUrl:function(a,b,d,e){a={adUnit:a,params:{iu:b.iu,cust_params:b.custom_params||{},output:"vast",
impl:"s",ad_type:"audio_video",env:"instream"}};e&&(a.bid=e);return this.getVASTUrl(a,d,this.pbjsBackfill,!0)},buildVideoUrl:function(a,b,d,e){a={adUnit:a,params:{iu:b.iu,description_url:"[description_url]",cust_params:b.custom_params||{},output:"vast"}};e&&(a.bid=e);return this.getVASTUrl(a,d,this.pbjs,!1)},getVASTUrl:function(a,b,d,e){e=e?this.player.config.Partner.program.Prebid:this.prebidConfig;return e.dont_use_dfp||"undefined"==typeof d.adServers?(BPLR.log("Prebid not using dfp.buildVideoUrl",
e.dont_use_dfp,typeof d.adServers),b.vastUrl||b.vastXML):d.adServers.dfp.buildVideoUrl(a)},hasPbjs:function(){var a=this.prebidConfig?this.prebidConfig.prebid_variable:this.player.config.Partner.program&&this.player.config.Partner.program.Prebid?this.player.config.Partner.program.Prebid.prebid_variable:null;return!(!h._pbjsGlobals||a&&0>h._pbjsGlobals.indexOf(a))},onNextVideo:function(a){if(!this.blockedByTimer){this.blockedByTimer=!0;setTimeout(this.$f(function(){this.blockedByTimer=!1}),1E3);for(key in this.refreshingTimeouts)clearTimeout(this.refreshingTimeouts[key]);
this.refreshingTimeouts=[];BPLR.log("Prebid onNextVideo",a.type,this.player.currentIndex,!!this.player.adsManager);this.bidding?BPLR.log("Prebid onNextVideo bidding still in progress...",this.bidding,this.midrollBidding):(this.allowScroll=this.playbackOccurred=this.bidding=!1,this.midrollLastBiddedCuepoint=null,this.runBidding())}},replaceMacros:function(a){var b=JSON.stringify(a);b.indexOf("__")&&(b=b.replace(/"__playerId__"/g,this.player.config.id),b=b.replace(/"__playerWidth__"/g,1),b=b.replace(/"__playerHeight__"/g,
1),b=b.replace(/__pageUrl__/g,x.getEmbededUrl()),b=b.replace(/"__player_width__"/g,0==this.player.width()||0==this.player.height()?"100%"==this.player.config.width?640:this.player.config.width:this.player.width()),b=b.replace(/"__player_height__"/g,0==this.player.width()||0==this.player.height()?"100%"==this.player.config.height?360:this.player.config.height:this.player.height()),this.player.currentSource&&this.player.currentSource.id&&(b=b.replace(/__videoId__/g,this.player.currentSource.id),b=b.replace(/__videoTitle__/g,
this.player.currentSource.title),b=b.replace(/__videoUrl__/g,-1<this.player.currentSource.src.indexOf("http")?this.player.currentSource.src:"https:"+this.player.currentSource.src)),a=JSON.parse(b));return a},checkAliases:function(a){a.forEach(function(b){b.bids.forEach(function(d){d.alias&&(this.aliases=this.aliases||[],this.aliases.includes[d.alias]||(BPLR.log("Prebid setting alias",d.alias,"=>",d.bidder),this.aliases.push(d.alias),this.pbjs.aliasBidder(d.bidder,d.alias)),d.bidder=d.alias,delete d.alias)},
this)},this)},getClosestPlayerSize:function(a){var b=this.player.width();return Array.isArray(a)&&Array.isArray(a[0])?a.reduce(function(d,e){return Math.abs(e[0]-b)<Math.abs(d[0]-b)?e:d}):a},getAdType:function(a){return"postroll"==a?"2":"midroll"==a?"1":"0"},checkExpiredBids:function(){var a=this.player.adsManager.ads.midroll,b=this.player.adsManager.ads.postroll,d=[],e=[];a&&a.adTags&&(d=d.concat(a.adTags));b&&b.adTags&&(d=d.concat(b.adTags));d=d.reduce(function(c,k){return c.concat(k)});d.forEach(function(c){("prebid"==
c.source||"combined"==c.source)&&c.data&&c.data.timestamp&&Date.now()-c.data.timestamp>=1E3*this.refreshTime&&e.push(c.data.unitId)}.bind(this));a=this.adUnits.filter(function(c){return c.id&&e.includes(c.id)});0<a.length&&(this.refreshingBids=!0,this.runBidding(a));BPLR.log("Prebid expired adTags",a)},getBackfillPbjs:function(a){BPLR.log("Prebid using",a,"pbjsGlobals",h._pbjsGlobals);h[a]=h[a]||{};h[a].que=h[a].que||[];this.pbjsBackfill=h[a]},getPbjs:function(a){if(this.pbjs)this.pbjs.onEvent&&!this.analyticsEventSet&&
(this.pbjs.onEvent("beforeRequestBids",function(b){this.player.trigger("beforeRequestBids",b)}.bind(this)),this.pbjs.onEvent("bidTimeout",function(b){for(var d=0;d<b.length;d++)this.player.trigger("bidderTimeout",b[d])}.bind(this)),this.analyticsEventSet=!0);else{if(this.prebidConfig&&this.prebidConfig.prebid_variable)a=this.prebidConfig.prebid_variable;else if(h._pbjsGlobals&&0<h._pbjsGlobals.length)a=0<=h._pbjsGlobals.indexOf("pbjs")?"pbjs":h._pbjsGlobals[h._pbjsGlobals.length-1];else if(!a)return;
BPLR.log("Prebid using",a,"pbjsGlobals",h._pbjsGlobals);h[a]=h[a]||{};h[a].que=h[a].que||[];(this.pbjs=h[a])&&this.pbjs.onEvent&&!this.analyticsEventSet&&(this.pbjs.onEvent("beforeRequestBids",function(b){this.player.trigger("beforeRequestBids",b)}.bind(this)),this.pbjs.onEvent("bidTimeout",function(b){for(var d=0;d<b.length;d++)this.player.trigger("bidderTimeout",b[d])}.bind(this)),this.analyticsEventSet=!0)}},generateAuctionId:function(){for(var a=[25,21,17,13],b="",d=32;0<d;--d)b+="0123456789abcdefghijklmnopqrstuvwxyz"[Math.floor(36*
Math.random())],a.includes(d)&&(b+="-");return b},onSellersLoad:function(a,b){BPLR.log("Prebid schainData",b,"success",a);this.schainData=b;this.waitingForSellersFile=!1;this.runBidding()},destroy:function b(){b.base.call(this)}});h.$bp.plugin("bridprebid",function(b,d){b=b||this;d=d||{};b.isReady?b.addChild(new h.$bp.Prebid(b,d)):h.$bp.Util.merge(b.config.children,{Prebid:{}})});BPLR.event.trigger(z,"bridpluginloaded")})(window,document);
