(function(v,w){var g=BPLR.Util,F=BPLR.event;v.$bp.Advertising=BPLR.Abstract.extend({currentAdsManager:null,adManagers:[],adSDKConfigReference:{brid:"VAST",ima:"GoogleIMA"},_iqAvailable:!1,adsLog:function(g){BPLR.log("%c"+g,"color: #4285f4;")},init:function a(d,c){if(d.config.hideAdContainer)return null;a.base.call(this,d,c);this.adsLog("Advertising init");this.el=this.createElement();this.somse="";this.skippedFired=!1;this.adsPool=[];this.ads={};this.adManagers=[];this.currentAdsManager=null;c=this.ads;
var b=d.config;d.advertising=!0;c.adOffset=b.adOffset?parseInt(b.adOffset):0;c.adFrequency=b.adFrequency?parseInt(b.adFrequency):0;c.bridAdPartner=!!b.Partner.bridAdPartner;c.adFrequency=0===c.adFrequency?1:c.adFrequency;BPLR.log("Advertising ads.adOffset",c.adOffset,"ads.adFrequency",c.adFrequency);c=function(a,b){var c=[],e=!1;a&&a.map(function(a){b[a]&&c.push(b[a])});if(1===c.length&&"VAST"==c[0]){var f=[];if(d.currentSource.id&&d.currentSource.Ad||0<d.videos.length&&d.videos[0].Ad)d.currentSource.id&&
d.currentSource.Ad?(BPLR.log("Take ads from currentSource"),a=d.currentSource.Ad):(BPLR.log("Take ads from first video"),a=d.videos[0].Ad),BPLR.log("playerAds",a),a.map(function(a){var b=a.Ad.desktop,c=a.Ad.mobile;a=b&&0<b.length;var e=c&&0<c.length,b=BPLR.isMobilePlatform?e?c:[]:a?b:c;a||e?(BPLR.log("Check",b),Array.isArray(b)||(b=[b]),b.forEach(function(a){f=f.concat(a)})):d.config.Ad.splice(index,1)});else if(d.config.AdSchedule){BPLR.log("Take ads from new player settings");var m=d.config.AdSchedule;
g.each(["preroll","midroll","postroll"],function(a){m[a]&&m[a].map(function(a,b){b=a.desktop;a=a.mobile;var c=b&&b.adSources,d=a&&a.adSources;(BPLR.isMobilePlatform?d?a:[]:c?b:a).adSources.map(function(a){a.Ad&&a.Ad.url&&(f=f.concat(a.Ad.url))})})})}else d.config.Ad&&(BPLR.log("Take ads from player settings"),a=d.config.Ad,BPLR.log("playerAds",a),a.map(function(a,b){var c=a.desktop,e=a.mobile,h=c&&0<c.length,k=e&&0<e.length,c=BPLR.isMobilePlatform?k?e:[]:h?c:e;h||k?(BPLR.log("Check",c),Array.isArray(c)||
(c=[c]),c.forEach(function(a){f=f.concat(a)})):(d.config.Ad.splice(b,1),1==a.adType&&(d.config.Prebid||d.config.A9)&&(d.config.prebidMidrollData={adTimeType:a.adTimeType,cuepoints:a.cuepoints}))}));BPLR.log("Final Array",f);if(0<f.length)for(a=0;a<f.length;a++)if(BPLR.log("Check url: ",f[a]),f[a].url){if(f[a].url&&(-1!=f[a].url.indexOf("googleads")||-1!=f[a].url.indexOf("21760922134")||-1!=f[a].url.indexOf("brid_parser=ima"))){e=!0;break}}else if(f[a]&&(-1!=f[a].indexOf("googleads")||-1!=f[a].indexOf("21760922134")||
-1!=f[a].indexOf("brid_parser=ima"))){e=!0;break}a=d.config.Partner;if(a.program){var l=a.program;a=l.desktop;var l=l.mobile,r=a&&0<a.length,n=l&&0<l.length;if(l=BPLR.isMobilePlatform?n?l:[]:r?a:l)for(a=0;a<l.length;a++)if(l[a].url&&l[a].url&&(-1!=l[a].url.indexOf("googleads")||-1!=l[a].url.indexOf("21760922134")||-1!=l[a].url.indexOf("brid_parser=ima"))){e=!0;break}}}0===c.length?c=BPLR.isMobilePlatform?["VAST","GoogleIMA"]:["GoogleIMA","VAST"]:1===c.length&&("VAST"===c[0]&&e&&c.push("GoogleIMA"),
"GoogleIMA"===c[0]&&c.push("VAST"));return c}(b.adSDK,this.adSDKConfigReference);BPLR.log("Advertising adManagerClasses",c);c.map(this.$f(function(a){"undefined"!==typeof BPLR[a]&&this.adManagers.push(new BPLR[a](d,{container:this.el,wrapper:this}))}));d.adsManager=this;if(d.isReady)this.onPlayerReady();else d.addOnce("ready",this.$f(this.onPlayerReady));g.isAmp()&&this.createTCFInsideAmpIframe();d.add("newContent",this.$f(this.checkScheduledAds));d.add(["stopped","skipped"],this.$f(this.onEnded));
d.add("playerresize",this.$f(this.onResize));d.add("start",this.$f(this.resetSkippedFired))},createElement:function(){var a=g.elById(this.player.id+"_adContainer");a||(a=g.createElement("div",{id:this.player.id+"_adContainer"}));if(!a)return!1;a.innerHTML="";g.addClass(a,"bplr-advert-container");a.style.maxWidth="none";a.style.maxHeight="none";a.style.minWidth="0";a.style.minHeight="0";return a},techCall:function(a,d,c){if((c=c||this.currentAdsManager)&&!c.error)if(BPLR.log("Advertising techCall ",
a,d),c.isReady)try{c[a](d)}catch(b){BPLR.error(b)}else c.ready(function(){this[a](d)})},techGet:function(a,d,c){if((c=c||this.currentAdsManager)&&!c.error)if(c.isReady)try{return c[a](d)}catch(b){void 0===c[a]?BPLR.warn("--- BPLRPlayer --- "+a+" method not defined for "+c.name+" advertising technology.",b):"TypeError"==b.name?BPLR.error("--- BPLRPlayer --- "+a+" unavailable on "+c.name+" advertising technology element.",b):BPLR.error(b)}else BPLR.warn("--- BPLRPlayer --- "+c.name+" ads manager is not ready")},
resetSkippedFired:function(){this.skippedFired=!1},onPlayerReady:function(){this.adsLog("Advertising onPlayerReady");var a=this.player;g.insertAfter(a.tag,this.el);this.defaultControlsBehaviour=a.config.controlsBehavior;a.config.autoplay&&!a.tech.support.monetizable&&(BPLR.warn("Advertising Shouldn't play ads tech not monetizable"),this.hide())},setupAdsLoader:function(){var a=this.player;if(a.showOnAd()||!a.tech.support.adManagement&&a.tech.support.monetizable)for(var a=0,d=this.adManagers.length;a<
d;a++)this.techCall("setupAdsLoader",null,this.adManagers[a]);else this.hide()},checkScheduledAds:function(a){this.adsLog("Advertising checkScheduledAds");a&&"newContent"==a.type&&(this.player.config.AdSchedule||this.player.config.Ad)&&(this.adsPool=[]);var d=this,c,b=this.player,e=this.ads,f=b.currentSource,h=b.config.AdSchedule?!0:!1,p=f.Ad;if(0==this.adsPool.length)if(this.adsLog("Advertising adsPool setup"),h){var u={preroll:{adTimeType:"s",adType:"0"},midroll:{adType:"1"},postroll:{adTimeType:"s",
adType:"2"},overlay:{adType:"3",adTimeType:"s"},banner:{adType:"4",adTimeType:"s"}},m=JSON.parse(JSON.stringify(b.config.AdSchedule));g.each(["preroll","midroll","postroll","overlay","banner"],function(a){if(m[a]){var b=g.merge({},u[a]);if("midroll"==a||"overlay"==a||"banner"==a)b=g.merge(b,m.data[a]);m[a].map(function(a,c){g.each(["mobile","desktop"],function(d){a[d]&&(b[d]=b[d]||[],b[d][c]=[],g.each(a[d].adSources,function(a){a.Ad&&a.Ad.url&&(a=g.clone(a.Ad),a.sc=m.id,b[d][c].push(a))}))})});d.adsPool.push(b)}})}else this.adsPool=
b.config.Ad?JSON.parse(JSON.stringify(b.config.Ad)):[];this.flagOurAd=!1;this.priority=0;this.ourAdPos=-1;e.overlay=e.midroll=e.postroll=e.preroll=e.banner=null;b.hasPreroll=!1;b.hasPostroll=!1;b.hasMidroll=!1;b.hasOverlay=!1;b.values.lastMidrollPlayedAt=null;b.remove("beforeStart",this.$f(this.onBeforeStart));b.remove("timeupdate",this.$f(this.checkForAd));this.adManagers=this.adManagers.filter(function(a){return!a.error});if(this.player.config.monetize)if(b.showOnAd()||b.tech.support.monetizable&&
f.monetize&&this.checkOffsetAndFrequency()&&0!==this.adManagers.length){if(b.config.freqCap&&(f=g.getLocalStorage(b.config.id+"_cap"),!(a&&a.data&&a.data.reinit)&&f&&"1"===f))return;this.contentCompleteCalled=!1;0<this.adsPool.length&&this.adsPool.map(function(a){"0"===a.adType&&(e.preroll=g.clone(a),e.preroll.played=!1);"1"===a.adType&&(e.midroll=g.clone(a),e.midroll.played=!1);"2"===a.adType&&(e.postroll=g.clone(a),e.postroll.played=!1);"3"===a.adType&&(e.overlay=g.clone(a),e.overlay.played=!1);
"4"===a.adType&&(e.banner=g.clone(a),e.banner.played=!1)});p&&p.map(function(a){"0"===a.Ad.adType&&(e.preroll=g.clone(a.Ad),e.preroll.played=!1);"1"===a.Ad.adType&&(e.midroll=g.clone(a.Ad),e.midroll.played=!1);"2"===a.Ad.adType&&(e.postroll=g.clone(a.Ad),e.postroll.played=!1);"3"===a.Ad.adType&&(e.overlay=g.clone(a.Ad),e.overlay.played=!1);"4"===a.Ad.adType&&(e.banner=g.clone(a.Ad),e.banner.played=!1)});a=e.preroll;var p=e.midroll,f=e.postroll,h=e.overlay,l=e.banner;a&&(a.adTags=this.selectAdTagsByPlatform(a));
p&&(p.adTags=this.selectAdTagsByPlatform(p),p.cuepoints=p.cuepoints.split(","),p.cuepointsStatus=[]);f&&(f.adTags=this.selectAdTagsByPlatform(f));l&&(l.adTags=this.selectAdTagsByPlatform(l));h&&(h.adTags=this.selectAdTagsByPlatform(h));var r=b.config.Partner,n=b.currentSource.age_gate_id?parseInt(b.currentSource.age_gate_id):0;BPLR.log("Advertising checkForScheduledAds ageGateID",n);var q=r.program;r.exclude&&q&&(q=this.excludeDfpBackfill(q,r.exclude));!this.flagOurAd&&e.bridAdPartner&&2>n&&q&&((this.networkAdTags=
this.selectAdTagsByPlatform(q))||q.backfill_prebid)&&(this.networkAdTags&&(c=this.networkAdTags[0]),BPLR.log("Ad program networkAdTags",c,"Ad program prebid tags",q.backfill_prebid),a&&(a.adTags=a.adTags||[[]],q.backfill_prebid&&q.backfill_prebid.preroll&&(a.adTags=a.adTags.map(function(a,b){return a.concat(q.backfill_prebid.preroll[b])})),c&&(a.adTags=a.adTags.map(function(a){return a.concat(c)})),a.adTags.priority=0,a.adTags.pod=0),f&&(f.adTags=f.adTags||[[]],q.backfill_prebid&&q.backfill_prebid.postroll&&
(f.adTags=f.adTags.map(function(a,b){return a.concat(q.backfill_prebid.postroll[b])})),c&&(f.adTags=f.adTags.map(function(a){return a.concat(c)})),f.adTags.priority=0,f.adTags.pod=0),p&&(p.adTags=p.adTags||[[]],q.backfill_prebid&&q.backfill_prebid.midroll&&(p.adTags=p.adTags.map(function(a,b){return a.concat(q.backfill_prebid.midroll[b])})),c&&(p.adTags=p.adTags.map(function(a){return a.concat(c)})),p.adTags.priority=0,p.adTags.pod=0),a||p||f||(a=e.preroll={adTimeType:"s",adType:"0",cuepoints:null,
overlayDuration:"10",overlayStartAt:null,played:!1},a.adTags=a.adTags||[[]],a.adTags=a.adTags[0].concat([c]),a.adTags.priority=0,a.adTags.pod=0));b.hasPreroll=!!(a&&a.adTags&&a.adTags.length&&a.adTags.some(function(a){return 0<a.length}));b.hasPostroll=!!(f&&f.adTags&&f.adTags.length&&f.adTags.some(function(a){return 0<a.length}));b.hasMidroll=!!(p&&p.adTags&&p.adTags.length&&p.adTags.some(function(a){return 0<a.length}));b.hasOverlay=!!(h&&h.adTags&&h.adTags.length&&h.adTags.some(function(a){return 0<
a.length}));b.hasBanner=!1;b.A9&&b.Prebid&&(b.hasPreroll&&(a.adTags=this.mergeA9WithPrebid(a.adTags)),b.hasMidroll&&(p.adTags=this.mergeA9WithPrebid(p.adTags)),b.hasPostroll&&(f.adTags=this.mergeA9WithPrebid(f.adTags)));b.hasMidroll&&b.config.auto_skip_at&&0<parseInt(b.config.auto_skip_at)&&(BPLR.log("Advertising disabling midrolls because of config.auto_skip_at"),b.hasMidroll=!1,p=e.midroll=null);if(!this.flagOurAd&&(l&&(l.adTags||l.mobile)||q&&q.banner)){l=l||{mobile:[],adType:"4"};r=q&&q.banner;
n=!!(b.config.Prebid&&b.config.Prebid.midroll&&b.config.Prebid.midroll.length||b.config.A9&&b.config.A9.midroll&&b.config.A9.midroll.length);b.hasBanner=!0;BPLR.log("Advertising add BannerAd",l,r);this.bannerManagerAdded||(this.adManagers.push(new BPLR.BannerAd(b,{container:this.el,wrapper:this})),this.bannerManagerAdded=!0);var k=l.adTags||l.mobile||[],k="string"===typeof k?[k]:k;Array.isArray(k[0])&&(k[0]=k[0][0]);l.adTags=k;r&&(l.adTags=l.adTags.concat(r));l.adTags.map(function(a){BPLR.log("Advertising add BannerAd",
a.overlayDuration,l.overlayDuration);var b=a[0]?a[0]:a.url?a:{id:"",url:a};b.url&&-1!=b.url.indexOf("<|>")||(b.url+="<|>"+(void 0===a.overlayDuration?l.overlayDuration:a.overlayDuration)||"")});if(b.hasMidroll||p&&p.adTags&&n)BPLR.log("Add banner fallback for midroll"),b.config.banner_is_fallback?p.adTags=p.adTags.map(function(a){return a.concat(l.adTags.slice())}):p.adTags.push(l.adTags.slice());b.hasPreroll?b.config.banner_is_fallback?a.adTags=a.adTags.map(function(a){return a.concat(l.adTags.slice())}):
a.adTags.push(l.adTags.slice()):(l.adTags=[l.adTags],a=e.preroll=l,b.hasPreroll=!0);e.preroll.adTags.priority=0;e.preroll.adTags.pod=0}BPLR.log("Advertising preroll",a,"midroll",p,"postroll",f,"overlay",h);b.tech.support.adManagement?(e.bridAd=this.networkAdTags,e.flagOurAd=this.flagOurAd,b.techCall("ads",e),q&&b.techCall("setProgram",q),this.techCall("destroyAdsLoader"),this.hide()):(this.show(),this.setupAdsLoader(),b.hasPreroll&&b.add("beforeStart",this.$f(this.onBeforeStart)),(b.hasMidroll||b.hasOverlay||
b.config.delayPreroll)&&b.add("timeupdate",this.$f(this.checkForAd)),b.add("ended",this.$f(this.onEnded)))}else BPLR.warn("Advertising Shouldn't play ads on non monetizable techs | Video or player not monetized | No Ad Managers initialized due to Ad Blocker or Network Error"),this.hide(),this.frequencyLimit=!0,this.techCall("destroyAdsLoader")},checkOffsetAndFrequency:function(){var a=!0;"undefined"!=typeof this.videosPlayed&&null!=this.videosPlayed||this.player.config.resetFreqCounter||(this.videosPlayed=
g.getLocalStorage(this.player.id+"_videos_played"));this.videosPlayed||(this.videosPlayed=1);BPLR.log("Advertising checkOffsetAndFrequency videosPlayed",this.videosPlayed,"adFrequency",this.ads.adFrequency,"adOffset",this.ads.adOffset);if(this.videosPlayed<this.ads.adOffset||0!=(this.videosPlayed-this.ads.adOffset)%this.ads.adFrequency)a=!1,this.player.config.autoplay_on_ad&&(this.player.config.autoplay=!1,this.player.config.autoplayInview=!1,BPLR.isMobilePlatform||(this.player.config.autoplay_on_ad=
!1));return a},onBeforeStart:function(){BPLR.log("Advertising onBeforeStart");this.player.remove("beforeStart",this.$f(this.onBeforeStart));this.hasAdRules=!1;this.resetManager();this.checkPreroll()},checkPreroll:function(){var a=this.ads.preroll;a&&!a.played&&this.player.config.monetize&&(this.player.config.delayPreroll||this.player.remove("timeupdate",this.$f(this.checkForAd)),this.preRequestAd(a))},checkDelayPreroll:function(){!(0>=this.player.duration())&&this.player.config.monetize&&0>=(this.player.config.delayPrerollTime?
parseInt(this.player.config.delayPrerollTime):5)-this.player.currentTime()&&(this.player.pause(),this.player.remove("timeupdate",this.$f(this.checkForAd)),this.player.adsManager.currentAdsManager.adsManager.resume(),this.show(),this.player.delayPrerollInProgress=!1,this.player.controls.onDisableInteraction(),this.player.progressControl.fadeOut(),this.player.touch.hide(),this.player.resetDuration=!0,this.player.controls.durationDisplay.updateContent(),g.addClass(this.player.el,"bplr-onad"),this.player.trackCurrentTime(),
this.player.config.delayPreroll=!1,this.player.addOnce("adEnd",this.$f(this.moveDelayedPrerollToMidroll)))},moveDelayedPrerollToMidroll:function(){delete this.player.config.Ad[0];this.player.config.Ad[1].cuepoints=(this.player.config.delayPrerollTime?parseInt(this.player.config.delayPrerollTime):5)+","+this.player.config.Ad[1].cuepoints},checkForMidroll:function(){var a;if(!(0>=this.player.duration()||!this.player.config.monetize||BPLR.isIPhone&&-1===this.player.currentSrc().indexOf(this.player.currentSource.src))){this.firstMidrollPositionOriginal||
(this.firstMidrollPositionOriginal=parseInt(this.ads.midroll.cuepoints[0]));if((this.player.currentSource.livestream||this.player.values.isLive)&&!Number.isInteger(this.player.currentTime())&&!this.player.currentSource.lsPlaybackStartedAt){this.player.currentSource.lsPlaybackStartedAt=this.player.currentTime();this.player.currentSource.livestreamStartedAt&&(a=Math.max(0,new Date/1E3-this.player.currentSource.livestreamStartedAt))&&(this.player.currentSource.lsPlaybackStartedAt-=a%this.firstMidrollPositionOriginal);
var d=this.player.currentSource.lsPlaybackStartedAt+this.firstMidrollPositionOriginal,c=d-this.ads.midroll.cuepoints[0];"i"==this.ads.midroll.adTimeType?this.ads.midroll.cuepoints=[d]:"s"==this.ads.midroll.adTimeType&&(this.ads.midroll.cuepoints=this.ads.midroll.cuepoints.map(function(a){return parseInt(a)+c}));BPLR.log("BPLR livestream midrolls",this.ads.midroll.cuepoints,"playbackStartedAt",this.player.currentSource.lsPlaybackStartedAt,"uptime","undefined"!=typeof a?g.formatTime(a):void 0)}var d=
this.player,b=this.ads.midroll,e=b.cuepoints;if("%"==b.adTimeType){for(var f=0;f<e.length;f++)e[f]=parseInt(parseInt(e[f])*d.duration()/100);b.adTimeType="s"}"i"==b.adTimeType&&1==e.length&&e.push(e[0]+this.firstMidrollPositionOriginal);for(f=0;f<e.length;f++){var h=parseInt(e[f]);if(!this.player.values.isLive)if(h>this.player.duration()){e.splice(f,1);BPLR.log("Advertising removing midroll at",h);continue}else 1>=this.player.duration()-h&&(b.cuepoints[f]--,h--,BPLR.log("Advertising moving midroll to",
h));a=h-d.currentTime();if(0>=a){if(d.waitingForAd&&!b.cuepointsStatus[h])break;if(d.values.lastMidrollPlayedAt&&.1>d.currentTime()-d.values.lastMidrollPlayedAt)break;BPLR.log("Advertising play midroll");d.values.lastMidrollPlayedAt=d.currentTime();d.remove("timeupdate",this.$f(this.checkForAd));e.splice(f,1);if(b.cuepointsStatus[h]&&"preRequestAd"==b.cuepointsStatus[h])BPLR.log("preRequestAd for cuepoint",h),d.pause(),BPLR.isIPhone&&d.isFullScreen&&"GoogleIMA"==d.adsManager.currentAdsManager.name&&
d.toggleFullScreen(!d.isFullScreen),d.adAboutToStart=!0,d.midrollPreload=!1,d.Advertising.tempTime=d.currentTime(),d.adsManager.start();else if(b.cuepointsStatus[h]&&"adError"==b.cuepointsStatus[h])d.midrollPreload=!1,d.trigger("hideAdInfo"),d.add("timeupdate",this.$f(this.checkForAd)),d.Advertising.tempTime=null;else if(d.adAboutToStart=!0,d.midrollPreload=!1,d.pause(),b.adTags.priority=0,b.adTags.pod=0,!this.preRequestAd(b))this.onContentResumeRequested();this.player.midrollNotMutedCase=!1;break}else if(5>
a&&0<a){b.cuepointsStatus[h]||!d.config||!d.config.id||d.hasBanner||"22954"==d.config.id||d.config.disableMidrollPreload||(BPLR.log("Create cuepoint",h),b.cuepointsStatus[h]="preRequestAd",d.midrollPreload=!0,b.adTags.priority=0,b.adTags.pod=0,this.preRequestAd(b));d.trigger("adStartsSoon");break}else d.trigger("hideAdInfo")}}},checkForOverlay:function(){var a=this.ads.overlay,d=this.player;if("s"==a.adTimeType)var c=d.currentTime()-a.overlayStartAt;else c=d.currentTime()-d.duration()*a.overlayStartAt/
100,a.overlayDuration=d.duration()*a.overlayDuration/100;0<c&&!a.playing&&!a.played&&this.preRequestAd(a)},checkForAd:function(){this.player.config.delayPreroll&&this.checkDelayPreroll();this.hasAdRules||!this.player.isPlaying||this.player.getAdInProgress()||((this.ads.midroll&&!this.player.config.MidrollOnlyWhenMuted||this.ads.midroll&&this.player.config.MidrollOnlyWhenMuted&&this.player.muted()||this.player.midrollNotMutedCase)&&this.checkForMidroll(),this.ads.overlay&&!this.ads.overlay.played&&
this.checkForOverlay())},getScheduledCuepoints:function(){var a=this.player,d=this.ads.midroll;if(d&&d.cuepoints&&0<d.cuepoints.length){var c=[];if("i"==d.adTimeType)(c=this.firstMidrollCuepoint)||(c=parseInt(d.cuepoints[0])),d=Math.ceil(a.currentTime()/c)*c,c=[d,d+c];else for(var b=0;b<d.cuepoints.length;b++)c.push("%"==d.adTimeType?parseInt(parseInt(d.cuepoints[b])*a.duration()/100):parseInt(d.cuepoints[b]));return c.filter(function(b){return b>a.currentTime()&&b<a.duration()})}return!1},removePassedCuepoints:function(){var a=
this.player,d=this.ads.midroll;if(d&&d.cuepoints&&0<d.cuepoints.length)if("i"==d.adTimeType){this.firstMidrollCuepoint||(d.cuepoints.splice(1),d.cuepoints[0]=parseInt(d.cuepoints[0]),this.firstMidrollCuepoint=d.cuepoints[0]);var c=Math.ceil(a.currentTime()/this.firstMidrollCuepoint)*this.firstMidrollCuepoint;d.cuepoints=[c]}else d.cuepoints=d.cuepoints.filter(function(b){return("%"==d.adTimeType?parseInt(parseInt(b)*a.duration()/100):parseInt(b))>a.currentTime()})},mergeA9WithPrebid:function(a){for(var d=
0;d<a.length;d++){var c=a[d].find(function(a){return"prebid"==a.source}),b=a[d].find(function(a){return"a9"==a.source});c&&b&&(b=b.url.match(/[&?]cust_params=(.*)(&|$)/i))&&b[1]&&(b=b[1].split("%26").filter(function(a){return 0==a.indexOf("amzn")}),0<b.length&&(BPLR.log("A9 merging params to prebid url",b,c.data),b=c.url.replace(/[&?]cust_params=/i,"$&"+b.join("%26")+"%26"),a[d]=a[d].filter(function(a){return"prebid"!=a.source&&"a9"!=a.source}),b={id:"",url:b,source:"combined",data:c.data},c.id&&
(b.id=c.id,b.sc=c.sc),a[d].unshift(b)))}return a},onEnded:function(a){BPLR.log("Advertising onEnded",a,this.skippedFired);this.player.remove("ended",this.$f(this.onEnded));this.firstMidrollCuepoint=null;if(this.skippedFired)return BPLR.log("Advertising onEnded skippedFired abort"),!1;a&&"skipped"==a.type&&(this.skippedFired=!0);if(!this.contentCompleteCalled){this.contentCompleteCalled=!0;(this.ads.overlay&&this.ads.overlay.playing||!this.isLinear())&&this.stopNonLinear();for(var d=0,c=this.adManagers.length;d<
c;d++)this.techCall("contentComplete",null,this.adManagers[d]);"ended"===a.type&&this.checkPostroll()}},checkPostroll:function(){var a=this.ads.postroll;a&&!a.played&&(this.player.remove("timeupdate",this.$f(this.checkForAd)),this.preRequestAd(a))},iframeHasFocus:function(){if(this.currentAdsManager){for(var a=this.currentAdsManager.el.getElementsByTagName("iframe"),d=0;d<a.length;d++)if(w.activeElement==a[d])return!0;if(w.BPLRIframeBurst&&0<=v.name.indexOf("google_ads_iframe")&&w.activeElement==
w.body)return!0}return!1},setAd:function(a,d,c,b){function e(a,b){return a.cpm>b.cpm?-1:a.cpm<b.cpm?1:0}if(this.player.currentSource.monetize||this.player.config.type){this.adsLog("Advertising setAd");var f=!1,h=a.pod||0,p=this.player,u=function(a,b){if(a.source&&"a9"==a.source&&a.wf_pos&&!p.Prebid)return a.wf_pos-1;var c=p.config.bid_order;if(!c||0==c.length||!a.source)return 0;var d=0,e=c.indexOf(a.source);0<e&&b.forEach(function(b,f){a.source&&(b=c.indexOf(b.source),b<e&&-1!=b&&(d=Math.max(d,f+
1)))});return d};"string"===typeof a.adTagUrl&&(a.adTagUrl=[a.adTagUrl]);var m="video"===d?this.player.currentSource.Ad:this.adsPool;"player"===d&&(this.player.currentSource.Ad=[]);if(m&&0<m.length)for(var l=0;l<m.length;l++){if(m[l].mobile&&0<m[l].mobile.length&&!Array.isArray(m[l].mobile[0])&&(m[l].mobile=[m[l].mobile]),m[l].desktop&&0<m[l].desktop.length&&!Array.isArray(m[l].desktop[0])&&(m[l].desktop=[m[l].desktop]),m[l].adType===a.adType)if(f=!0,c){m[l].mobile||m[l].desktop||(m[l].mobile=[]);
if(m[l].mobile){h>=m[l].mobile.length&&(h=m[l].mobile.length,m[l].mobile[h]=[]);for(var r=0;r<a.adTagUrl.length;r++){var n={id:"",url:a.adTagUrl[r]};a.data&&(n.data=a.data);a.id&&(n.id=a.id);a.sc&&(n.sc=a.sc);a.source&&(n.source=a.source);a.bidder&&(n.bidder=a.bidder);a.wf_pos&&(n.wf_pos=a.wf_pos);a.cpm&&(n.cpm=a.cpm);m[l].mobile[h].splice(u(n,m[l].mobile[h]),0,n)}}if(m[l].desktop)for(h>=m[l].desktop.length&&(h=m[l].desktop.length,m[l].desktop[h]=[]),r=0;r<a.adTagUrl.length;r++)n={id:"",url:a.adTagUrl[r]},
a.data&&(n.data=a.data),a.id&&(n.id=a.id),a.sc&&(n.sc=a.sc),a.source&&(n.source=a.source),a.bidder&&(n.bidder=a.bidder),a.wf_pos&&(n.wf_pos=a.wf_pos),a.cpm&&(n.cpm=a.cpm),m[l].desktop[h].splice(u(n,m[l].desktop[h]),0,n)}else for(m[l].mobile=m[l].mobile||[],h>=m[l].mobile.length&&(h=m[l].mobile.length),m[l].mobile[h]=[],r=0;r<a.adTagUrl.length;r++)n={id:"",url:a.adTagUrl[r]},a.data&&(n.data=a.data),a.id&&(n.id=a.id),a.sc&&(n.sc=a.sc),a.source&&(n.source=a.source),a.bidder&&(n.bidder=a.bidder),a.wf_pos&&
(n.wf_pos=a.wf_pos),a.cpm&&(n.cpm=a.cpm),m[l].mobile[h].push(n)}else m=this.adsPool=[];if(!f)if(1==a.adType&&!a.cuepoints&&this.player.config.prebidMidrollData&&(a.cuepoints=this.player.config.prebidMidrollData.cuepoints,a.adTimeType=this.player.config.prebidMidrollData.adTimeType),1!=a.adType||"string"===typeof a.cuepoints&&0<a.cuepoints.length){a.mobile=[[]];for(r=0;r<a.adTagUrl.length;r++)n={id:"",url:a.adTagUrl[r]},a.source&&(n.source=a.source),a.bidder&&(n.bidder=a.bidder),a.id&&(n.id=a.id),
a.sc&&(n.sc=a.sc),a.cpm&&(n.cpm=a.cpm),a.mobile[0].push(n);"video"===d?m.push({Ad:a}):m.push(a);delete a.adTagUrl}else BPLR.log("Cannot SetAd, not enough parameters provided for missing ad slot");BPLR.log("SetAd END",m);a.source&&"prebid"==a.source&&a.cpm&&g.each(["mobile","desktop"],function(a){for(var b=0;b<m.length;b++)if(m[b][a])for(var c=0;c<m[b][a].length;c++)m[b][a][c].sort(e)});b||this.checkScheduledAds()}},appendPod:function(a,d){var c="video"===d?this.player.currentSource.Ad:this.player.config.Ad;
BPLR.log("BPLR appendPod",c,"ad",a);for(var b=0;b<c.length;b++)c[b].adType==a.adType&&["mobile","desktop"].forEach(function(d){c[b][d]&&Array.isArray(c[b][d])&&c[b][d].push([{id:"",url:a.adTagUrl,source:a.source}])})},replacePrebidTag:function(a){function d(a,b){return a.cpm>b.cpm?-1:a.cpm<b.cpm?1:0}var c=0==a.adType?this.ads.preroll:1==a.adType?this.ads.midroll:2==a.adType?this.ads.postroll:null,b=!1;if(c&&c.adTags){for(var e=0;e<c.adTags.length;e++)for(var f=0;f<c.adTags[e].length;f++)if(c.adTags[e][f].data&&
a.data.unitId==c.adTags[e][f].data.unitId){var h="prebid"==c.adTags[e][f].source;var g="combined"==c.adTags[e][f].source,u="a9"==c.adTags[e][f].source;if("prebid"==a.source){if(h||g||u)(h=c.adTags[e][f].url.match(/amzn.*?%26/g))&&(g||u)&&(a.adTagUrl=a.adTagUrl.replace(/[&?]cust_params=/i,"$&"+h.join(""))),c.adTags[e][f].data=a.data,c.adTags[e][f].url=a.adTagUrl,u&&(c.adTags[e][f].source="combined"),BPLR.log("Prebid replaced URL",c.adTags[e][f]),b=!0}else"a9"==a.source&&(h&&(h=a.adTagUrl.match(/amzn.*?%26/g))&&
(c.adTags[e][f].url=c.adTags[e][f].url.replace(/[&?]cust_params=/i,"$&"+h.join("")),c.adTags[e][f].source="combined",BPLR.log("Prebid replaced URL added A9 to Prebid",c.adTags[e][f]),b=!0),g||u)&&(h=a.adTagUrl.match(/amzn.*?%26/g))&&(c.adTags[e][f].url=c.adTags[e][f].url.replace(/amzn.*?%26/g,""),c.adTags[e][f].url=c.adTags[e][f].url.replace(/[&?]cust_params=/i,"$&"+h.join("")),BPLR.log("Prebid replaced URL replaced A9 to Combined OR isA9",c.adTags[e][f]),b=!0)}if(!b){b=parseInt(a.pod);f={id:"",url:a.adTagUrl,
data:a.data,cpm:a.data.cpm,source:a.source};for(e=0;e<=b;e++)c.adTags[e]||(c.adTags[e]=[]);c.adTags[b].unshift(f);BPLR.log("Prebid replaced URL (added)",c.adTags)}if("prebid"==a.source&&a.cpm)for(e=0;e<c.adTags.length;e++)c.adTags[e].sort(d);1!=a.adType||this.player.hasMidroll||(this.removePassedCuepoints(),this.player.hasMidroll=!0,this.player.remove("timeupdate",this.$f(this.checkForAd)),this.player.add("timeupdate",this.$f(this.checkForAd)))}},playAd:function(a){BPLR.log("Advertising playAd",a);
var d=this.player;d.config.monetize&&d.currentSource.monetize&&(a.adTagUrl&&"string"===typeof a.adTagUrl&&(a.adTagUrl=[a.adTagUrl]),a=this.flagOurAd?this.networkAdTags:a,a="string"===typeof a?{adTagUrl:[a]}:"array"===typeof a?{adTagUrl:a}:a,a.adTags=this.selectAdTagsByPlatform(a),d.newContent=!1,d.tech.support.adManagement?(this.hide(),this.player.techCall("playAd",a)):this.preRequestAd(a))},selectAdTagsByPlatform:function(a){var d=a.flashAdTagUrl||a.desktop,c=a.adTagUrl||a.mobile,b=d&&0<d.length,
e=c&&0<c.length,b=BPLR.isMobilePlatform?e?c:null:b?d:c;BPLR.log("Advertising selectAdTagsByPlatform ",a.adType,"desktop",d,"mobile",c);if(b){Array.isArray(b)&&(b=b.slice());"string"===typeof b&&(b=[{id:"0",url:b}]);0<b.length&&!Array.isArray(b[0])&&(BPLR.log("Advertising converting old ad structure to new",b),b=[b]);for(a=0;a<b.length;a++)b[a]=b[a].map(function(a,b){return"string"===typeof a?{id:"",url:a}:a});b.pod=0;b.priority=0}else b=null;BPLR.log("Advertising selectAdTagsByPlatform ads",b);return b},
excludeDfpBackfill:function(a,d){var c={},b=a.desktop&&0<a.desktop.length,e=a.mobile&&0<a.mobile.length,f=a.banner&&0<a.banner.length;if(b=BPLR.isMobilePlatform?e?a.mobile:null:b?a.desktop:a.mobile){var h="";BPLR.isMobilePlatform?(c.mobile=[],h="mobile"):(c.desktop=[],h="desktop");b=b.map(function(a,b){if(-1==a.url.indexOf("21760922134"))c[h].push(a);else{var e=!0;g.each(d,function(a){BPLR.Util.getEmbededUrl()==a&&(e=!1)});e&&c[h].push(a)}})}f&&a.banner.map(function(a,b){-1==a.url.indexOf("google")&&
(c.banner||(c.banner=[]),c.banner.push(a))});return c},selectPriorityAdTag:function(a){var d=null,c=this.player.config,b=c.Partner.program;BPLR.log("Advertising selectPriorityAdTag",a);if(!a||0==a.length)return!1;(this.flagOurAd?!this.ads.overlay||!this.ads.overlay.playing:1)&&a[a.pod]&&a.priority<a[a.pod].length?(d=a[a.pod][a.priority],a.priority++):a.priority=0;BPLR.log("Advertising tag",d,"pod",a.pod,"priority",a.priority);this.flagOurAd=!!(d&&c.backfill_monetize&&b&&(b.desktop&&-1!==b.desktop.indexOf(d)||
b.mobile&&-1!==b.mobile.indexOf(d)||b.banner&&-1!==b.banner.indexOf(d)));d&&d.url&&0===d.url.indexOf("http://")&&(d.url=d.url.substr(5));return d},selectAdsManager:function(a){for(var d,c=0,b=this.adManagers.length;c<b;c++)if(this.adManagers[c].supportsAdTag(a)&&!this.adManagers[c].error&&!d){d=this.adManagers[c];break}return d},preRequestAd:function(a){BPLR.log("Advertising preRequestAd",a,this.techGet("isLinear"),this.currentAdObject);if(!a)return!1;for(var d=a.adTags.length-1;0<=d;d--)0==a.adTags[d].length&&
a.adTags.splice(d,1);this.currentAdObject&&(this.ads.overlay&&this.ads.overlay.playing||!this.isLinear())&&this.stopNonLinear();this.thirdParty=!1;this.currentAdObject=a;this.currentAdObject.played=!0;if(a=this.selectPriorityAdTag(a.adTags))return this.currentAdObject.currentID=a.id,this.requestAd(a.url),!0;!BPLR.isIPhone&&this.currentAdsManager&&"GoogleIMA"==this.currentAdsManager.name&&(this.currentAdsManager.adsLoader=null,this.currentAdsManager.adDisplayContainer&&(this.currentAdsManager.adDisplayContainer.destroy(),
this.currentAdsManager.adDisplayContainer=null));BPLR.log("Advertising no more adtags");return!1},getAdData:function(){var a=this.currentAdObject;if(a&&a.adTags){var d=a.adTags.pod,c=a.adTags.priority-1,b=g.deepCopy(a.adTags[d][c]);if(0<Object.keys(b).length)return b.adInProgress=this.player.getAdInProgress(),b.adType=a.adType,b.pod=d,b.position=c,b}return null},requestAd:function(a){function d(){BPLR.log("DIS",t.additionalRequestsConfig);for(var a=0;a<t.additionalRequestsConfig.length;a++)BPLR.Loader.loadText(t.additionalRequestsConfig[0][0],
t.additionalRequestsConfig[0][1],t.additionalRequestsConfig[0][2])}function c(){t.ipRequestFinished&&t.contextualRequestFinished&&m(a)}function b(a,b,c){var d=new RegExp("[&?]"+b+"=","i");return a=d.test(a)?a.replace(d,"$&"+encodeURIComponent(c)+"%26"):a+((-1==a.indexOf("?")?"?":"&")+b+"="+encodeURIComponent(c))}function e(a,b,c){return-1!=a.toLowerCase().indexOf(".spotxchange.")?a.replace(new RegExp("="+b.replace(/(\[|])/g,"\\$1"),"gi"),"="+c):a.split(b).join(c).split(b.toUpperCase()).join(c)}function f(a){t.ipRequestFinished=
!0;BPLR.error("--- BPLRPlayer --- IP fetch failed",a);c()}function h(b){t.ipRequestFinished=!0;try{"string"===typeof b&&(g.setLocalStorage("brid_location",b,!1,k.config),b=JSON.parse(b),g.location=b),BPLR.log("Advertising location",b),a=e(a,"[user_ip]",encodeURIComponent(b.connection.ip)),a=e(a,"[ipaddress]",encodeURIComponent(b.connection.ip)),a=e(a,"[latitude]",encodeURIComponent(b.location.latitude.toString())),a=e(a,"[longitude]",encodeURIComponent(b.location.longitude.toString())),c()}catch(I){BPLR.error("--- BPLRPlayer --- IP parse failed",
I),c()}}function p(a){t.contextualRequestFinished=!0;BPLR.error("--- BPLRPlayer --- IP fetch failed",a);c()}function u(b){t.contextualRequestFinished=!0;try{if(g.setLocalStorage("brid_"+t.contextualHash,b,!1,k.config),b=JSON.parse(b),BPLR.contextual=b,BPLR.log("BRID CONTEXTUAL",BPLR.contextual),0<BPLR.contextual.length){var d="";g.each(BPLR.contextual,function(a,b){a=a.split("|");d+=1<a.length?a[a.length-1].replaceAll("-"," "):a[0].replaceAll("-"," ");b<BPLR.contextual.length-1&&(d+=",")});a=e(a,
"[iab_taxonomy]",encodeURIComponent(d));a=e(a,"%5Biab_taxonomy%5D",encodeURIComponent(d))}else{var f=a.match(/[&?]cust_params=(.*)(&|$)/i);if(f&&f[1]){var h=f[1].split("%26");1==h.length?a=a.replace("&cust_params="+f[1],""):1<h.length&&g.each(h,function(b,c){if(-1<b.indexOf("[iab_taxonomy]")||-1<b.indexOf("%5Biab_taxonomy%5D"))a=a.replace(b+"%26",""),a=a.replace("%26"+b,"")})}}}catch(J){BPLR.error("--- BPLRPlayer --- IP parse failed",J)}finally{c()}}function m(a){function b(){if("function"===typeof A.__tcfapi){BPLR.log("GDPR __tcfapi exists");
if(p){!q.cancelTimeout&&!q.timeoutFnCalled&&q.intervalCurrent>=q.timeout&&(q.timeoutFnCalled=!0,setTimeout(d,1500),BPLR.log("GDPR __tcfapi response timed out!"));if(g.isAmp()&&void 0!=k.values.ampGDPR)if(!q.ampFoundAt&&!q.ampAPIError)q.ampFoundAt=q.intervalCurrent;else if(q.ampAPIError||q.ampFoundAt-q.intervalCurrent>q.timeoutAMP||q.intervalCurrent>=q.timeout){c();return}return q.intervalCurrent+=50}p=!0;A.__tcfapi("getTCData",2,function(b,h){q.timeoutFnCalled||(q.cancelTimeout=!0,BPLR.log("GDPR __tcfapi tcData",
b,"success",h),!h&&g.isAmp()?(void 0!=k.values.ampGDPR&&c(),q.ampAPIError=!0):b.gdprApplies&&"cmpuishown"==b.eventStatus?(clearInterval(r),BPLR.log("GDPR __tcfapi waiting for useractioncomplete"),A.__tcfapi("addEventListener",2,function(b,c){c&&"useractioncomplete"===b.eventStatus&&(BPLR.log("GDPR __tcfapi useractioncomplete player tcfActionNotCompleted",k.values.tcfActionNotCompleted,"waitingForAd",k.waitingForAd),k.waitingForAd&&!1!==k.values.tcfActionNotCompleted&&(t.checkGdprCalled=!1,m(a)),k.values.tcfActionNotCompleted=
!1,A.__tcfapi("removeEventListener",2,function(a){},b.listenerId))}),setTimeout(d,q.timeoutUserResponse)):(a=e(a,"[gdpr]",b.gdprApplies?"1":"0"),a=e(a,"[consent]",b.tcString||""),f()))});g.isAmp()&&k.trigger("requestAMPGDPR")}else"function"===typeof A.__cmp?(BPLR.log("GDPR __cmp exists"),p||(p=!0,setTimeout(function(){BPLR.log("GDPR __cmp timeout exceed!");a=e(a,"[gdpr]","0");f()},500),A.__cmp("getConsentData",null,function(b){BPLR.log("GDPR __cmp responseObject",b);a=e(a,"[gdpr]",b.gdprApplies?"1":
"0");a=e(a,"[consent]",b.consentData||"");f()}))):(BPLR.log("GDPR __cmp / __tcfapi don't exist",h),h+=50,h>=q.timeoutAPI&&f())}function c(){BPLR.log("GDPR using AMP consent data",k.values.ampGDPR);a=e(a,"[gdpr]",k.values.ampGDPR.gdprApplies?"1":"0");a=e(a,"[consent]",k.values.ampGDPR.gdprString||"");f()}function d(){!n&&k.currentSrc()&&"undefined"==typeof k.values.tcfActionNotCompleted&&(BPLR.log("GDPR __tcfapi useractioncomplete not received in timely manner, continuing without ads"),clearInterval(r),
k.values.tcfActionNotCompleted=!0,t.onContentResumeRequested())}function f(){n||(BPLR.log("GDPR FIRE request"),l(a));clearInterval(r);r=null;n=!0}if(t.checkGdprCalled)return!1;t.checkGdprCalled=!0;var h=0,p=!1,n=!1,q={intervalCurrent:0,timeout:3E3,timeoutAMP:200,timeoutAPI:500,timeoutUserResponse:k.config.consent_wait_time||4E3,timeoutFnCalled:!1,cancelTimeout:!1,ampAPIError:!1,ampFoundAt:null};if(/\[(gdpr|consent|npa)\]/i.test(a)||k.config.wait_tcf_api){BPLR.log("GDPR macro exists / wait for TCF API");
var r=setInterval(b,50)}else l(a)}function l(a){function b(){c+=50;BPLR.log("uspCheckIntervalCurrent",c);500<=c&&(clearInterval(f),f=null,d=!0,r(a))}var c=0,d=!1;if(-1!=a.toLowerCase().indexOf("[us_privacy]"))if(BPLR.log("USPAPI macro exists"),"function"===typeof A.__uspapi){BPLR.log("USPAPI __uspapi exists");var f=setInterval(b,50);A.__uspapi("getUSPData",1,function(b,c){a=e(a,"[us_privacy]",c?b.uspString:"");d||(BPLR.log("USPAPI FIRE request"),r(a));f&&(clearInterval(f),f=null)})}else BPLR.log("USPAPI __uspapi does not exist"),
a=e(a,"[us_privacy]",""),r(a);else r(a)}function r(a){function b(){v.goog&&v.goog.pal?c(a):f?(BPLR.log("GoogleIMA PAL not initialized"),t.nonceManager=null,n(a)):(BPLR.Loader.loadScript("https://imasdk.googleapis.com/pal/sdkloader/pal.js",b,n.bind(this,a)),BPLR.log("GoogleIMA PAL SDK loading"),f=!0)}function c(){BPLR.log("GoogleIMA PAL generating nonce");if(!k.currentSource&&t.nonceString||k.currentSource.src&&t.nonceGeneratedFor==k.currentSource.src)d();else{var b=new goog.pal.ConsentSettings,b=
new goog.pal.NonceLoader(b),c=new goog.pal.NonceRequest;c.adWillAutoPlay=k.config.autoplay;c.adWillPlayMuted=k.muted();c.continuousPlayback=k.isNextQueued();c.descriptionUrl=k.currentSrc()?k.currentSource.src:"";c.iconsSupported=!0;c.playerType="bplr-player";c.playerVersion=k.config.VERSION;c.ppid=k.config.nonce_ppid?k.config.nonce_ppid:"";c.sessionId=g.getSession();c.supportedApiFrameworks="2,7,9";c.url=g.getEmbededUrl();c.videoHeight=parseInt(k.el.style.width);c.videoWidth=parseInt(k.el.style.height);
b.loadNonceManager(c).then(function(a){t.nonceManager=a;t.nonceString=a.getNonce();BPLR.log("GoogleIMA PAL nonce generated",t.nonceString);d()}).catch(function(b){t.nonceManager=null;t.nonceString=null;BPLR.log("GoogleIMA PAL error generating nonce",b);n(a)})}}function d(){a=e(a,"[paln]",t.nonceString);a=e(a,"[nonce]",t.nonceString);n(a)}var f=!1;v.Promise&&/\[(paln|nonce)\]/i.test(a)&&"GoogleIMA"==y.name?b():(t.nonceManager=null,n(a))}function n(a){function b(b){a=e(a,"[schain]",g.formatSchainMacro(b));
q(a)}if(-1!=a.toLowerCase().indexOf("[schain]")){var c=g.getSchain(k,function(c,d){c?b(d):q(a)});c?b(c):null==c&&q(a)}else q(a)}function q(a){BPLR.exLog("requestAd: ",a,"currentAdsManager",y.name);BPLR.log("doRequest","pod",x.adTags.pod,"priority",x.adTags.priority);if(BPLR.Util.adBlockerEnabled)k.trigger("adBlock",{flagOurAd:t.flagOurAd,at:x.adType,am:y.name,ai:x.currentID});else{var b=x.adTags.pod,c=x.adTags.priority-1;t.flagOurAd?(0>t.ourAdPos&&(t.ourAdPos=c),k.trigger("ourAdRequest",{am:y.name,
at:"BannerAd"===y.name?"4":x.adType,pp:b,wp:c-t.ourAdPos,baid:x.adTags[b][c].id})):k.showOnAd()?k.trigger("adUnitRequest",{am:y.name,at:"BannerAd"===y.name?"4":x.adType,pp:b,wp:c,baid:x.adTags[b][c].id}):k.showOnAd()||(BPLR.log("BPLR Advertising trigger partnerAdRequest",c),k.trigger("partnerAdRequest",{am:y.name,at:"BannerAd"===y.name?"4":x.adType,pp:b,wp:c,baid:x.adTags[b][c].id,sc:x.adTags[b][c].sc,bidder:x.adTags[b][c].bidder}))}if("3"!=x.adType){b="";for(c=32;0<c;--c)b+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*
Math.random())];t.somse=b;k.trigger("requestAd",x);k.add("adImpression",function(){Array.prototype.slice.call(arguments,1);(!arguments[0].data||arguments[0].data.s&&arguments[0].data.s!=t.somse)&&k.trigger("incrementCredit")});k.add("adEnd",function(){Array.prototype.slice.call(arguments,1);(!arguments[0].data||arguments[0].data.s&&arguments[0].data.s!=t.somse)&&k.trigger("incrementCreditComplete")})}t.doStartAdCalled=!1;t.techCall("requestAd",a)}var k=this.player,t=this,x=this.currentAdObject;var z=
x.adTags.priority-1;var A=w.BPLRIframeBurst?v.top:v,D=A.document;k.fireTicks&&0==x.adType&&0==x.adTags.pod&&0==z&&!this.flagOurAd&&(k.timer.tick("request"),k.trigger("tick",{tickType:"rq",tickTime:k.timer.ticks.request}));k.waitingForAd=!0;this.checkGdprCalled=this.adErrored=this.isPodTag=this.adSkipped=this.adPlayed=!1;this.additionalRequestsConfig=[];this.contextualRequestFinished=this.ipRequestFinished=!1;this.contextualHash=btoa('{"url":"'+A.location.href+'"}');var y=this.currentAdsManager=this.selectAdsManager(a);
z=-1<a.indexOf("doubleclick")&&25>a.indexOf("doubleclick");var F=-1<a.indexOf("springserve")&&15>a.indexOf("springserve");if(this.player.values.tcfActionNotCompleted)BPLR.log("GDPR __tcfapi user action not completed"),this.onContentResumeRequested();else if(!k.isPipActive||"BannerAd"!==y.name&&"3"!==this.currentAdObject.adType)if(this.tempTime||0!=x.adTags.pod||(this.tempTime=k.currentTime()),k.config.autoplayStickyAdOnly&&(void 0===k.config.autoplayInviewOriginal&&(k.config.autoplayInviewOriginal=
k.config.autoplayInview),k.config.autoplayInview=!1,k.closed=!1),y&&!y.error){if(z&&"GoogleIMA"==y.name)this.hasAdRules=-1!=a.indexOf("ad_rule=1");else{this.hasAdRules=!1;if(-1!=a.toLowerCase().indexOf("[timestamp]")){var E=(new Date).getTime();a=e(a,"[timestamp]",E)}-1!=a.toLowerCase().indexOf("[referrer_url]")&&(a=e(a,"[referrer_url]",encodeURIComponent(z?g.getEmbededUrl():D.referrer)))}-1!=a.toLowerCase().indexOf("[description_url]")&&(a=e(a,"[description_url]",encodeURIComponent(g.getEmbededUrl())));
-1!=a.toLowerCase().indexOf("[page_url]")&&(a=e(a,"[page_url]",encodeURIComponent(g.getEmbededUrl())));-1!=a.toLowerCase().indexOf("[video_title]")&&(a=e(a,"[video_title]",encodeURIComponent(k.currentSource.title)));-1!=a.toLowerCase().indexOf("[video_duration]")&&(a=e(a,"[video_duration]",k.duration()||k.currentSource.duration));-1!=a.toLowerCase().indexOf("[video_id]")&&(a=e(a,"[video_id]",k.currentSource.id));-1!=a.toLowerCase().indexOf("[player_width]")&&k.el&&(k.el.clientWidth||parseInt(k.el.style.width))&&
(a=e(a,"[player_width]",k.el.clientWidth||parseInt(k.el.style.width)));-1!=a.toLowerCase().indexOf("[player_height]")&&k.el&&(k.el.clientHeight||parseInt(k.el.style.height))&&(a=e(a,"[player_height]",k.el.clientHeight||parseInt(k.el.style.height)));-1!=a.toLowerCase().indexOf("[player_id]")&&(a=e(a,"[player_id]",k.config.id));-1!=a.toLowerCase().indexOf("[player_os]")&&(a=e(a,"[player_os]","l"==g.getOS()?"o":g.getOS()));-1!=a.toLowerCase().indexOf("[player_type]")&&(a=e(a,"[player_type]","BPLR.Player"==
k.name?"p":"o"));-1!=a.toLowerCase().indexOf("[player_size]")&&(a=e(a,"[player_size]",k.config.id+"_"+k.getSizeStr()));-1!=a.toLowerCase().indexOf("%5bplayer_size%5d")&&(a=e(a,"%5Bplayer_size%5D",k.config.id+"_"+k.getSizeStr()));-1!=a.toLowerCase().indexOf("[autoplay]")&&(a=e(a,"[autoplay]",k.config.autoplay?"1":"0"));-1!=a.toLowerCase().indexOf("[description]")&&(a=e(a,"[description]",encodeURIComponent(k.currentSource.description)));-1!=a.toLowerCase().indexOf("[mediafile_url]")&&(a=e(a,"[mediafile_url]",
encodeURIComponent(k.currentSource.src)));-1!=a.toLowerCase().indexOf("[dnt]")&&(a=e(a,"[dnt]",navigator.doNotTrack&&"1"===navigator.doNotTrack?"1":"0"));-1!=a.toLowerCase().indexOf("[viewability]")&&(a=e(a,"[viewability]",k.isPlayerInView()?"1":"0"));-1!=a.toLowerCase().indexOf("[vpmute]")&&(a=e(a,"[vpmute]",k.muted()?"1":"0"));-1!=a.toLowerCase().indexOf("[uid]")&&(a=e(a,"[uid]",g.getSession()));-1!=a.toLowerCase().indexOf("[video_tags]")&&(a=e(a,"[video_tags]",encodeURIComponent(k.currentSource.tags||
"")));-1!=a.toLowerCase().indexOf("[bplr_site]")&&(a=e(a,"[bplr_site]",encodeURIComponent(k.config.Partner?k.config.Partner.domain_short:"")));if(-1!=a.toLowerCase().indexOf("[bplr_")){for(var E=a,K=/\[bplr_([a-zA-Z0-9_-]+)\]/g;D=K.exec(a);)E=e(E,D[0],encodeURIComponent("undefined"!=typeof bplrMacros&&D[1]in bplrMacros?bplrMacros[D[1]]:""));a=E}-1!=a.toLowerCase().indexOf("[user_agent]")&&(a=e(a,"[user_agent]",encodeURIComponent(g.ua)));if(k.currentSource.customParams&&z&&!this.flagOurAd)for(B in k.currentSource.customParams)k.currentSource.customParams.hasOwnProperty(B)&&
(a=e(a,"[item-"+B+"]",encodeURIComponent(k.currentSource.customParams[B])));try{var C=v.localStorage?v.localStorage.getItem("_pdfps"):!1;if(C&&(z||F)){var G="permutive="+JSON.parse(C).join();a=b(a,z?"cust_params":"brid_permutive",G)}}catch(H){BPLR.error("--- BPLRPlayer --- LocalStorage Error",H)}-1!==a.toLowerCase().indexOf("[user_ip]")||-1!==a.toLowerCase().indexOf("[ipaddress]")||-1!==a.toLowerCase().indexOf("[latitude]")||-1!==a.toLowerCase().indexOf("[longitude]")?g.location?h(g.location):this.additionalRequestsConfig.push(["https://api.clarifyip.com/?key=1s5JByAIGeaeEphPkqPlq",
h,f]):this.ipRequestFinished=!0;!k.config.Partner.contextual||-1===a.toLowerCase().indexOf("[iab_taxonomy]")&&-1===a.toLowerCase().indexOf("%5biab_taxonomy%5d")?this.contextualRequestFinished=!0:(BPLR.contextual=g.getLocalStorage("brid_"+this.contextualHash),BPLR.contextual?u(BPLR.contextual):this.additionalRequestsConfig.push(["//"+w.loadFromHost+"/services/contextual/"+k.config.owner_id+"/"+k.config.Partner.id+".json?contextual_content="+this.contextualHash,u,p]));0<this.additionalRequestsConfig.length?
d():this.ipRequestFinished&&this.contextualRequestFinished&&m(a)}else{BPLR.error("--- BPLRPlayer --- Unsupported adTag or Ad Manager initialization failed");BPLR.exLog("Unsupported adTag or Ad Manager initialization failed");C=x.adTags.pod;z=x.adTags.priority-1;G=this.flagOurAd&&0<this.ourAdPos?z-this.ourAdPos:z;var B=y?y.name:"AdBlock";B={ec:9999,am:B,pub:this.flagOurAd?"b":"p",pp:C,wp:G,at:"BannerAd"===B?"4":x.adType};0<=z&&(B.baid=x.adTags[C][z].id,B.sc=x.adTags[C][z].sc);k.trigger("adErrorAnalytics",
B);this.preRequestAd(x)?BPLR.log("Advertising prerequest success"):(BPLR.log("Advertising prerequest fail"),this.hide(),this.adErrored=!0,this.resetManager(),k.trigger("adError",{message:"Unsupported adTag or Ad Manager initialization failed"}),this.onContentResumeRequested())}else BPLR.log("PIP : A banner or an overlay is stopped from loading. Picture-in-picture mode was active."),this.onContentResumeRequested()},stopNonLinear:function(){BPLR.log("AdsManager stopNonLinear");this.onResize(null);this.ads.overlay&&
(this.ads.overlay.playing=!1);this.currentAdsManager&&(this.currentAdsManager.el&&this.currentAdsManager.el.removeAttribute("style"),this.techCall("stop"));this.ourAdPos=-1;this.player.currentSrc()&&(this.resetManager(),this.reset())},onAdError:function(a,d,c){var b=this.player,e=this.currentAdObject,f=this.currentAdsManager,h=e?e.adTags.pod:0,g=e?e.adTags.priority-1:0,u=this.flagOurAd&&0<this.ourAdPos?g-this.ourAdPos:g,f=f?f.name:"GoogleIMA";BPLR.log("Advertising onAdError message",a,b.newContent,
d,c,f);c||(c=8888);e&&(u={ec:c,am:f,pub:this.flagOurAd?"b":"p",pp:h,wp:u,at:"BannerAd"===f?"4":e.adType},0<=g&&(u.baid=e.adTags[h][g].id),b.trigger("adErrorAnalytics",u));if(b.newContent)b.trigger("adError",{message:a,code:c});else{if(d){this.adManagers=this.adManagers.filter(function(a){return!a.error});if(0===this.adManagers.length){b.trigger("adError",{message:a,code:c});this.adErrored=!0;this.onContentResumeRequested();return}this.currentAdObject&&--this.currentAdObject.adTags.priority}501==c&&
this.adPlayed&&b.config.soft501?(this.adErrored=!0,this.resetManager(),this.onContentResumeRequested()):this.preRequestAd(this.currentAdObject)?BPLR.log("Advertising prerequest success"):(BPLR.log("Advertising prerequest fail"),this.adErrored=!0,this.resetManager(),b.trigger("adError",{message:a,code:c}),b.fireTicks=!1,this.onContentResumeRequested())}},onAdStart:function(a){var d=this.player,c=this.currentAdObject,b=!1;BPLR.log("Advertising onAdStart isLinear",this.techGet("isLinear"));this.techGet("isLinear")?
(d.adInProgress=!0,d.manualTimeUpdatesOn(),d.trigger("play")):c&&(c.overlayDuration&&0!==c.overlayDuration||(c.overlayDuration=d.duration()?d.duration()-d.currentTime():15),this.currentAdObject===this.ads.overlay&&(this.ads.overlay.playing=!0),this.adPlayed=!0,this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null),-1===this.duration()&&(b=!0,this.closeTimeout=setTimeout(this.$f(this.stopNonLinear),1E3*c.overlayDuration)),this.currentAdsManager.adsManager.isVPAID&&!this.currentAdsManager.adsManager.adManager.tech._adUnit._creative.getAdLinear()&&
(b=!0,this.closeTimeout=setTimeout(this.$f(this.stopNonLinear),1E3*c.overlayDuration)));d.trigger("adStart",{nonlinear:b});d.onScroll();a&&d.trigger("vpaidStart");this.thirdParty&&d.trigger("3rdPartyAdStart")},onAdImpression:function(){var a=this.currentAdObject,d=this.player,c=this.currentAdsManager,b=a.adTags.pod,e=a.adTags.priority-1,f={spotx:"SpotX",rubicon:"Rubicon",ix:"ix",pubmatic:"Pubmatic",openx:"OpenX",onevideo:"Adapt",telaria:"Telaria",appnexus:"Appnexus",triplelift:"Triplelift",amazon:"Amazon",
unruly:"Unruly",rise:"Rise",videobyte:"VideoByte",onetag:"OneTag",yahoossp:"Yahoo",kargo:"Kargo",gumgum:"GumGum",sharethrough:"ShareThrough","33across":"33Across"};d.fireTicks&&0==b&&0==a.adType&&(d.timer.tick("adimpression"),d.trigger("tick",{tickType:"ai",tickTime:d.timer.ticks.adimpression,wp:e}),d.fireTicks=!1);d.waitingForAd=!1;d.waitForInViewAdAutoplay=!1;this.adPlayed=!0;this.techGet("isLinear")&&(d.adInProgress=!0);BPLR.log("Advertising onAdImpression flagOurAd",this.flagOurAd);var h={s:this.somse};
if("GoogleIMA"==c.name&&c.currentAd&&d.config.Prebid&&d.config.Prebid.creatives){var p=a.adTags[b][e].data||{},u=c.currentAd.getCreativeId(),m=c.currentAd.getWrapperCreativeIds()||[],l=c.currentAd.getWrapperAdSystems(),r=l.some(function(a){return a.includes("AdSense")});m.push(u);u=m.find(function(a){return d.config.Prebid.creatives.hasOwnProperty(a)});l=l.find(function(a){return"prebid.org wrapper"==a});p.bidder=u?d.config.Prebid.creatives[u].toLowerCase():p.bidder&&l&&"prebid.org wrapper"==l?f[p.bidder]?
f[p.bidder].toLowerCase():p.bidder.toLowerCase():r?"adsense/adx":"other";p.source=a.adTags[b][e].source;h=g.merge(h,p)}d.trigger("adImpression",h);h.bidder&&h.source&&("prebid"==h.source||"combined"==h.source)&&d.trigger("bidderImpression",h);d.config.autohide_ad_controls||d.trigger("show");this.flagOurAd?d.trigger("ourAdImpression",{am:c.name,at:"BannerAd"===c.name?"4":a.adType,pp:b,wp:e-this.ourAdPos,baid:a.adTags[b][e].id}):d.showOnAd()?d.trigger("adUnitImpression",{am:c.name,at:"BannerAd"===c.name?
"4":a.adType,pp:b,wp:e,baid:a.adTags[b][e].id}):d.showOnAd()||d.trigger("partnerAdImpression",{am:c.name,at:"BannerAd"===c.name?"4":a.adType,pp:b,wp:e,baid:a.adTags[b][e].id,sc:a.adTags[b][e].sc,bidder:a.adTags[b][e].bidder,cpm:a.adTags[b][e].cpm})},onAdComplete:function(){var a=this.currentAdObject,d=this.player,c=this.currentAdsManager,b=a.adTags.pod,e=a.adTags.priority-1;BPLR.log("Advertising onAdComplete",a,e,b);this.adSkipped||d.trigger("adComplete",{wp:e-this.ourAdPos-1,pod:b,pods:a.adTags.length});
this.flagOurAd?d.trigger("ourAdComplete",{am:c.name,at:"BannerAd"===c.name?"4":a.adType,pp:b,wp:e-this.ourAdPos,baid:a.adTags[b][e].id}):d.showOnAd()?d.trigger("adUnitComplete",{am:c.name,at:"BannerAd"===c.name?"4":a.adType,pp:b,wp:e,baid:a.adTags[b][e].id}):d.showOnAd()||d.trigger("partnerAdComplete",{am:c.name,at:"BannerAd"===c.name?"4":a.adType,pp:b,wp:e,baid:a.adTags[b][e].id,sc:a.adTags[b][e].sc,bidder:a.adTags[b][e].bidder})},onAdSkipped:function(){var a=this.currentAdObject,d=this.player,c=
a.adTags.pod,b=a.adTags.priority-1;BPLR.log("Advertising onAdSkip",a,b,c);d.trigger("adSkip",{wp:b-this.ourAdPos-1,pod:c,pods:a.adTags.length})},onContentPauseRequested:function(){var a=this.player;BPLR.log("Advertising onContentPauseRequested",a.isPlaying);this.tempTime||0!=this.currentAdObject.adTags.pod||(this.tempTime=a.currentTime());a.isPlaying&&(BPLR.log("POZIV PAUZE 1"),a.pause());a.remove("ended",this.$f(this.onEnded));a.trigger("disableInteraction")},onContentResumeRequested:function(){function a(){null!==
b.children&&(BPLR.log("Advertising resumeFromTimeIma",c.tempTime),c.tempTime?setTimeout(function(){b.currentTime(c.tempTime);b.play();c.tempTime=null},700):b.play(),b.tech&&!b.tech.support.timeupdateEvent&&b.manualTimeUpdatesOn(),b.trigger("startTrackingTime"))}function d(){null!==b.children&&(BPLR.log("Advertising resumeFromTime",c.tempTime),c.tempTime&&setTimeout(function(){b.currentTime(c.tempTime);c.tempTime=null},500),b.tech&&!b.tech.support.timeupdateEvent&&b.manualTimeUpdatesOn(),b.trigger("startTrackingTime"))}
var c=this,b=c.player,e=c.contentCompleteCalled;if(null!==b.children)if(BPLR.log("Advertising onContentResumeRequested contentCompleteCalled",e,"currentSrc",b.currentSrc(),"currentSource",b.currentSource.src,"_this.tempTime",c.tempTime,"player current Time",b.tag.currentTime,"autoplay_on_ad",b.config.autoplay_on_ad,"adErrored",this.adErrored,"adPlayed",this.adPlayed,"player.userInteracted",b.userInteracted,"doStartAdCalled",this.doStartAdCalled,"midrollPreload",b.midrollPreload,"adsManager name",
this.currentAdsManager?this.currentAdsManager.name:"NULL"),this.currentAdObject&&this.currentAdObject.adTags.pod+1<this.currentAdObject.adTags.length&&(!b.closed||b.currentSrc()))this.currentAdsManager&&"GoogleIMA"==this.currentAdsManager.name&&this.currentAdsManager.adsManager&&0==this.currentAdsManager.adsManager.getCuePoints().length&&this.currentAdsManager.adsLoader&&(BPLR.log("CALL adsLoader.contentComplete 1"),this.currentAdsManager.adsLoader.contentComplete()),this.currentAdObject.adTags.pod++,
BPLR.log("Advertising going to next pod",this.currentAdObject,this.currentAdObject.adTags.pod),this.reset(),this.currentAdObject.adTags.priority=0,this.preRequestAd(this.currentAdObject);else if(!this.adPlayed&&!this.adErrored&&this.currentAdsManager&&"GoogleIMA"==this.currentAdsManager.name&&this.currentAdsManager.adsManager&&!this.currentAdsManager.adsManager.getCuePoints().find(function(a){return a>b.currentTime()||-1==a})&&this.currentAdObject&&2>this.currentAdObject.adTags.length)this.onAdError("GoogleIMA All ads completed without an impression");
else this.currentAdsManager&&"GoogleIMA"==this.currentAdsManager.name&&!b.delayPrerollInProgress&&this.currentAdsManager.adsManager&&0==this.currentAdsManager.adsManager.getCuePoints().length&&this.currentAdsManager.adsLoader&&(BPLR.log("CALL adsLoader.contentComplete 1"),this.currentAdsManager.adsLoader.contentComplete(),!BPLR.isIPhone&&this.currentAdsManager.currentAd&&this.currentAdsManager.currentAd.isLinear()&&"2"!==this.currentAdObject.adType&&setTimeout(function(){!this.player.waitingForAd&&
this.currentAdsManager&&this.currentAdsManager.currentAd&&this.currentAdsManager.currentAd.isLinear()&&(this.currentAdsManager.adsLoader=null,this.currentAdsManager.adDisplayContainer&&(this.currentAdsManager.adDisplayContainer.destroy(),this.currentAdsManager.adDisplayContainer=null))}.bind(this),100)),b.delayPrerollInProgress||(c.reset(),b.trigger("adsCompleted")),b.muted(b.values.muted),b.volume(b.values.volume),b.remove("ended",c.$f(c.onEnded)),b.add("ended",c.$f(c.onEnded)),b.currentSrc()&&(!b.config.autoplay_on_ad||
c.adPlayed||b.userInteracted||b.config.autoplayStickyAdOnly?b.midrollPreload&&this.adErrored?(g.each(this.currentAdObject.cuepointsStatus,function(a,b){"preRequestAd"===a&&(c.currentAdObject.cuepointsStatus[b]="adError")}),this.adErrored=!0):setTimeout(this.$f(function(){if(null!==b.children){BPLR.log("Advertising resumeContent");if(b.config.autoplayStickyAdOnly){BPLR.log("Advertising autoplayStickyAdOnly positionType",b.positionType,"isPlayerInView",b.isPlayerInView(),"adPlayed",this.adPlayed);var f=
!this.adPlayed&&b.config.autoplay_on_ad;b.config.autoplayInview=!f;b.config.autoplay_on_ad=!1;b.SlideInView&&b.SlideInView.close&&b.SlideInView.close.trigger("close");b.closed=!0;if(f||!b.isPlayerInView()&&!0===b.config.autoplayInviewOriginal){b.trigger("showPoster");b.pause();return}}b.config.autoplay&&b.config.pause_after_preroll&&!b.values.pausedAfterPreroll?(b.values.pausedAfterPreroll=!0,b.trigger("pause"),b.trigger("showPoster"),b.pause()):!e&&(!b.currentSource.error&&-1===b.currentSrc().indexOf(b.currentSource.src)&&
BPLR.isIPhone||!b.currentSource.error&&-1===b.currentSrc().indexOf(b.currentSource.src)&&0==b.tag.currentTime||""==b.tag.src)?(BPLR.log("Advertising onContentResumeRequested 1"),b.stopTrackingCurrentTime(),b.trigger("stopTrackingTime"),BPLR.isIPhone?b.addOnce("loadedmetadata",a):b.addOnce("loadedmetadata",d),b.src(b.currentSource),b.load(),BPLR.isIPhone||b.play()):e?(BPLR.log("Advertising onContentResumeRequested 3"),BPLR.isIPhone&&-1===b.currentSrc().indexOf(b.currentSource.src)&&(this.adSkipped&&
b.src(b.currentSource),0==b.tag.currentTime&&(b.remove("ended",this.$f(this.onEnded)),b.src(b.currentSource),b.newContent=!0,b.trigger("newContent")),b.trigger("showPoster")),b.remove("loadedmetadata",d),c.tempTime=null):(BPLR.log("Advertising onContentResumeRequested 2"),c.tempTime?BPLR.isIPhone&&0==b.tag.currentTime?(b.load(),b.addOnce("loadedmetadata",a)):setTimeout(function(){b.play();BPLR.log("Advertising resumeFromTime",c.tempTime);c.tempTime=null;b.trigger("durationChange")},300):b.play())}}),
0):(BPLR.log("ULECEMO OVDE BESNO!!!"),b.onScrollFunc&&(BPLR.log("REMOVE SCROLL ALSO"),b.removeScroll()),this.adErrored=!0))},reset:function(){var a=this.player;a.adInProgress=!1;this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null);a.tag&&(g.removeClass(a.tag,"bplr-animate"),g.css(a.tag,{height:""},!1,"important"),setTimeout(function(){g.addClass(a.tag,"bplr-animate")},250));BPLR.log("Advertising reset",this.techGet("isLinear"));this.isLinear()&&(this.adErrored||this.adPlayed)&&
(this.ourAdPos=-1);a.waitingForAd=!1;a.trigger("enableInteraction");if(this.ads.midroll||this.ads.overlay)a.remove("timeupdate",this.$f(this.checkForAd)),a.add("timeupdate",this.$f(this.checkForAd));a.trigger("adEnd",{s:this.somse})},resetManager:function(){BPLR.log("BPLR.Advertising resetManager");this.techCall("resetManager");this.currentAdsManager&&this.currentAdsManager.el&&this.currentAdsManager.el.removeAttribute("style");this.currentAdsManager&&(this.currentAdsManager=null)},start:function(){this.currentAdsManager&&
this.techCall("start",this.paused)},stop:function(){this.currentAdsManager&&this.techCall("stop")},play:function(a){a=this.player;a.tech.support.adManagement?a.techCall("play"):this.currentAdsManager&&this.techCall("togglePlay",!0)},pause:function(a){a=this.player;a.tech.support.adManagement?a.techCall("pause"):this.currentAdsManager&&this.techCall("togglePlay",!1)},togglePlay:function(a){var d=this.player;d.pausedOnInteraction="undefined"!=typeof a;BPLR.log("Advertisement togglePlay",this.currentAdsManager,
"this.paused",this.paused);d.tech.support.adManagement?d.techGet("paused")?d.techCall("play"):d.techCall("pause"):this.currentAdsManager&&this.techCall("togglePlay",this.paused)},duration:function(){return this.player.tech.support.adManagement?this.player.techGet("duration"):this.currentAdsManager?this.techGet("duration"):0},currentTime:function(){return this.player.tech.support.adManagement?this.player.techGet("currentTime"):this.currentAdsManager?this.techGet("currentTime"):0},volume:function(a){var d=
this.player;if("undefined"!==typeof a)if(BPLR.log("Advertising set volume",a),d.tech.support.adManagement)d.techCall("setVolume",a);else return this.currentAdsManager?this.techCall("volume",a):0;else return d.tech.support.adManagement?parseFloat(d.techGet("volume")):this.currentAdsManager?this.techGet("volume"):0},hide:function(){for(var a=0,d=this.adManagers.length;a<d;a++)this.techCall("hide",null,this.adManagers[a])},show:function(){for(var a=0,d=this.adManagers.length;a<d;a++)this.techCall("show",
null,this.adManagers[a])},onResize:function(a){this.currentAdsManager&&(a=a?100:0,setTimeout(this.$f(function(){this.techCall("onResize")}),a))},isLinear:function(){return"undefined"===typeof this.techGet("isLinear")||null===this.techGet("isLinear")||this.techGet("isLinear")},createTCFInsideAmpIframe:function(){function a(a){var c={};try{c="string"===typeof a.data?JSON.parse(a.data):a.data}catch(h){}(a=c.__tcfapiReturn)&&a.callId&&"function"===typeof b[a.callId]&&(b[a.callId](a.returnValue,a.success),
b[a.callId]=null)}for(var d=v,c,b={};d;){try{if(d.frames.__tcfapiLocator){c=d;break}}catch(e){}if(d===v.top)break;d=d.parent}c?(BPLR.log("TCF API create stub object"),v.__tcfapi=function(a,d,h,g){var e="bp_"+Math.random()+"",f={__tcfapiCall:{command:a,parameter:g,version:d,callId:e}};b[e]=h;c.postMessage(f,"*");"addEventListener"==a&&v.__tcfapi("getTCData",d,h,g)},v.addEventListener("message",a,!1)):BPLR.log("TCF API not found, stub object not created")}});BPLR.GoogleIMA=BPLR.Abstract.extend({adsManager:null,
adsLoader:null,adDisplayContainer:null,ad:null,hasAdRules:!1,isVPAID:!1,vpaidMode:"",adTimeout:15,init:function d(c,b){d.base.call(this,c,b);BPLR.log("GoogleIMA init");this.el=b.container;this.parent=b.wrapper;this.adDisplayContainerInitialized=!1;this.name="GoogleIMA";this.adDisplayContainer=this.adsLoader=this.adsManager=null;if(c.config.monetize)if(this.isMoatConfigured(c)&&this.initializeMoatTrackingFunction(),"undefined"===typeof google||"undefined"===typeof google.ima)this.count=0,BPLR.Loader.load("js",
"https://imasdk.googleapis.com/js/sdkloader/ima3.js",this.onDependencyLoad,null,this);else this.onDependencyLoad()},isMoatConfigured:function(d){try{return!!d.config.Partner.moat_settings}catch(c){return!1}},initializeMoatTrackingFunction:function(){this.initMoatTracking=function(d,c,b,e){if(!1===c.hasOwnProperty("partnerCode"))return!1;var f=w.createElement("script");b=b||d&&("undefined"!==typeof d.O?d.O.parentNode:w.body)||w.body;var h=[],g={vidIntType:"4",vidIntVersion:"1.0",adsManager:d,ids:c,
imaSDK:!0,events:[],dispatchEvent:function(b){var c=this.sendEvent,d=this.events;c?(d&&(d.push(b),b=d),c(b)):d&&d.push(b)},clientCallback:e},u={complete:"AdVideoComplete",firstquartile:"AdVideoFirstQuartile",impression:"AdImpression",loaded:"AdLoaded",midpoint:"AdVideoMidpoint",pause:"AdPaused",skip:"AdSkipped",start:"AdVideoStart",thirdquartile:"AdVideoThirdQuartile",volumeChange:"AdVolumeChange"};if(google&&google.ima&&d){var m="_moatApi"+Math.floor(1E8*Math.random());for(var l in google.ima.AdEvent.Type)e=
function(b){if(g.sendEvent){for(b=h.length-1;0<=b;b--)d.removeEventListener(h[b].type,h[b].func);g.sendEvent(g.events)}else g.events.push({type:u[b.type]||b.type,adVolume:d.getVolume()})},d.addEventListener(google.ima.AdEvent.Type[l],e),h.push({type:google.ima.AdEvent.Type[l],func:e})}m="undefined"!==typeof m?m:"";try{var r=b.ownerDocument;var n=r.defaultView||r.parentWindow}catch(q){r=w,n=v}n[m]=g;f.type="text/javascript";b&&b.appendChild(f);f.src="https://z.moatads.com/"+c.partnerCode+"/moatvideo.js#"+
m;return g}},onDependencyLoad:function(){var d=this.player;BPLR.log("GoogleIMA onDependencyLoad",this.count);if(!this.el)return this.error=!0,this.parent.onAdError("Ad Container not present",!0),this.hide(),null;if("undefined"===typeof google||"undefined"===typeof google.ima)return 10>this.count?(this.count++,setTimeout(this.$f(this.onDependencyLoad),50)):(this.error=!0,this.parent.onAdError("Google IMA not initialized. Make sure Ad blocker is disabled",!0),this.hide()),null;d.add("userInteraction",
this.$f(this.onUserInteraction));d.add("lastSecond",this.$f(this.onLastSecond));d.add("dompositionchange",this.$f(this.onDOMPositionChange));d.config&&d.config.id&&"22954"!=d.config.id&&(google.ima.settings.setPlayerType("bplr-player"),google.ima.settings.setPlayerVersion(d.config.VERSION));google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0);google.ima.settings.setFeatureFlags({enableOmidBeta:!0});google.ima.settings.setNumRedirects(8);d.config.translate&&d.config.translate.ima_locale&&google.ima.settings.setLocale(d.config.translate.ima_locale);
this.triggerReady()},hide:function(){this.el&&g.css(this.el,{display:"none"})},show:function(){this.el&&g.css(this.el,{display:"block"})},onDOMPositionChange:function(){this.destroyAdsLoader();this.onUserInteraction()},onUserInteraction:function(d){var c=this.player;BPLR.log("GoogleIMA onUserInteraction isPlaying",d);c.showOnAd()||!c.tech.support.adManagement&&c.tech.support.monetizable?(BPLR.log("GoogleIMA onUserInteraction isPlaying",c.isPlaying,"adDisplayContainer",this.adDisplayContainer,"adDisplayContainerInitialized",
this.adDisplayContainerInitialized,"adsLoader",this.adsLoader),this.adDisplayContainer&&!this.adDisplayContainerInitialized&&(this.adDisplayContainerInitialized=!0,this.adDisplayContainer.initialize())):this.hide()},setVPAIDMode:function(d){BPLR.log("GoogleIMA setVPAIDMode",d);google.ima.settings.setVpaidMode(d);this.vpaidMode=d},setupAdsLoader:function(){BPLR.log("GoogleIMA setupAdsLoader",this.el,this.player.tag);!this.adsLoader&&this.player.tag&&(this.adDisplayContainer||(this.adDisplayContainer=
new google.ima.AdDisplayContainer(this.el,this.player.tag),this.player.adDisplayContainer=this.adDisplayContainer,BPLR.isIPhone||(BPLR.log("setupAdsLoader adDisplayContainer.initialize() 2"),this.adDisplayContainerInitialized=!0,this.adDisplayContainer.initialize())),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.$f(this.onAdsManagerLoaded),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,
this.$f(this.onAdError),!1))},contentComplete:function(){BPLR.log("GoogleIMA contentComplete");this.adsLoader&&this.adsLoader.contentComplete();!this.adsManager||this.adsManager.getCuePoints().length&&-1!=this.adsManager.getCuePoints().indexOf(-1)||this.resetManager()},requestAd:function(d){var c=this.player;var b=!c.config.ima_secure_mode;if(-1!==d.indexOf("ima3vpaid.appspot.com")){var e=g.queryStringToObj(d.split("?")[1]);BPLR.log("GoogleIMA stripIMAWrapper",e);d=e.adTagUrl?decodeURIComponent(e.adTagUrl):
d}this.adTag=d;this._hasResponse=!1;if("undefined"===typeof google||"undefined"===typeof google.ima)this.error=!0,this.parent.onAdError("Google IMA not initialized. Make sure Ad blocker is disabled",!0),this.hide();else{this.adsLoader||this.setupAdsLoader();this.show();if(-1!=d.toLowerCase().indexOf("brid_vpaidmode")||-1!=d.toLowerCase().indexOf("brid_adtimeout"))b=d.split("?")[1]?g.queryStringToObj(d.split("?")[1]):-1!=d.toLowerCase().indexOf("brid_vpaidmode=insecure")?{brid_vpaidmode:"insecure"}:
{},BPLR.log("GoogleIMA requestAd params",b),this.adTimeout=b.brid_adtimeout||this.adTimeout,b=b.brid_vpaidmode&&"insecure"==b.brid_vpaidmode,d=d.replace("&brid_vpaidmode=insecure","");b?this.setVPAIDMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE):this.setVPAIDMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED);d=g.removeParam("brid_parser",d);b=new google.ima.AdsRequest;g.validateURL(d)?b.adTagUrl=d:-1!==d.indexOf("<VAST")&&-1!==d.indexOf("</VAST>")?b.adsResponse=d:(BPLR.error("--- BPLRPlayer --- VAST Template or Ad Tag ndo not have a proper format"),
BPLR.exLog("VAST Template or Ad Tag does not have a proper format"),this.parent.onAdError("VAST Template or Ad Tag do not have a proper format"));b.linearAdSlotWidth=c.el.offsetWidth;b.linearAdSlotHeight=c.el.offsetHeight;b.nonLinearAdSlotWidth=c.el.offsetWidth;b.nonLinearAdSlotHeight=c.el.offsetHeight;c.config.maxNonlinearHeight&&(e=c.config.maxNonlinearHeight,"string"==typeof e&&-1!=e.indexOf("%")&&(e=parseFloat(e)*c.el.offsetHeight/100),b.nonLinearAdSlotHeight=Math.min(c.el.offsetHeight,parseInt(e)),
BPLR.log("GoogleIMA setting nonLinearAdSlotHeight",b.nonLinearAdSlotHeight,"player height",c.el.offsetHeight));b.vastLoadTimeout=1E3*this.adTimeout;var e=c.config.autoplay,f=c.muted();BPLR.log("GoogleIMA autoplayAllowed",e,"autoplayRequiresMuted",f,"continuousPlayback",c.isNextQueued());d=c.config.Partner&&["20786","20977","21393"].includes(c.config.Partner.id)&&/iu=\/21760922134[\/,]/.test(d);c.config.id&&"22954"!=c.config.id&&(b.setAdWillAutoPlay(e),b.setAdWillPlayMuted(c.config.ima_force_vpmute||
d?!1:f),b.setContinuousPlayback(c.isNextQueued()));try{this.adsLoader.requestAds(b)}catch(h){BPLR.error("--- BPLRPlayer --- Google IMA Error. Google IMA initialization failed",h),BPLR.exLog("Google IMA Error. Google IMA initialization failed",h),this.parent.onAdError("Google IMA Error. Google IMA initialization failed")}}},onAdsManagerLoaded:function(d){var c=this.player,b=this.parent.currentAdObject,e=b.adTags.pod,f=b.adTags.priority-1;c.fireTicks&&0==b.adType&&0==e&&(c.timer.tick("adresponse"),
c.trigger("tick",{tickType:"ar",tickTime:c.timer.ticks.adresponse,wp:f}));c.trigger("AdsManagerLoadedEvent",{adsManagerLoadedEvent:d});b=new google.ima.AdsRenderingSettings;b.loadVideoTimeout=1E3*this.adTimeout;b.mimeTypes="video/mp4 video/webm video/x-msvideo video/mpeg video/ogg application/javascript application/octet-stream audio/mpeg audio/mp4".split(" ");c.config.ad_max_bitrate&&0<c.config.ad_max_bitrate&&(b.bitrate=c.config.ad_max_bitrate);d=this.adsManager=d.getAdsManager(c.tag,b);if(this.isMoatConfigured(c)){BPLR.log("GoogleIMA onAdsManagerLoaded: MOAT settings found!",
c.config.Partner.moat_settings);try{var h=BPLR.Util.getJsonFromUrl(this.adTag);BPLR.log("GoogleIMA onAdsManagerLoaded: MOAT adTagQueryStringJson",h);var p=g.merge(c.config.Partner.moat_settings.ids,{viewMode:google.ima.ViewMode.NORMAL,zMoatAdUnitPath:h.iu?h.iu:""});BPLR.log("GoogleIMA onAdsManagerLoaded: MOAT ids",p);this.initMoatTracking(d,p,this.el);BPLR.log("GoogleIMA onAdsManagerLoaded: MOAT configuration went fine!")}catch(m){BPLR.error("GoogleIMA onAdsManagerLoaded: MOAT initMoatTracking call failed!",
m)}}this.onContentPauseRequestedFunc=this.$f(this.onContentPauseRequested);this.onContentResumeRequestedFunc=this.$f(this.onContentResumeRequested);this.onAdEventFunc=this.$f(this.onAdEvent);0<d.getCuePoints().length&&-1!==d.getCuePoints().indexOf(-1)&&(c.hasPostroll=!0);d.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.$f(this.onAdError));d.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequestedFunc);d.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,
this.onContentResumeRequestedFunc);var h=[google.ima.AdEvent.Type.ALL_ADS_COMPLETED,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.THIRD_QUARTILE,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.RESUMED,google.ima.AdEvent.Type.CLICK,google.ima.AdEvent.Type.DURATION_CHANGE,google.ima.AdEvent.Type.SKIPPED,google.ima.AdEvent.Type.USER_CLOSE,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,
google.ima.AdEvent.Type.IMPRESSION,google.ima.AdEvent.Type.LOG],u;for(u in h)d.addEventListener(h[u],this.onAdEventFunc);try{BPLR.log("GoogleIMA onAdsManagerLoaded adDisplayContainerInitialized",this.adDisplayContainerInitialized,"canAutoplay",c.canAutoplay(),"isFacebookApp",g.isFacebookApp());if(!this.adDisplayContainerInitialized){if(!c.canAutoplay()){BPLR.event.add(w.body,"click",this.$f(this.onInteraction));return}this.onUserInteraction()}this.doStartAd()}catch(m){d&&(d.removeEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,
this.onContentPauseRequestedFunc),d.removeEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequestedFunc)),BPLR.error("--- BPLRPlayer --- Google IMA Error. There was a problem with the VAST response",m.getError?m.getError():m),BPLR.exLog("Google IMA Error. There was a problem with the VAST response",m.getError?m.getError():m),this.parent.onAdError("Google IMA Error. There was a problem with the VAST response.")}},onInteraction:function(){BPLR.event.remove(w.body,
"click",this.$f(this.onInteraction));this.onUserInteraction();this.doStartAd()},doStartAd:function(){var d=this.player;BPLR.log("GoogleIMA doStartAd 1");this.parent.doStartAdCalled=!0;this.adsManager.init(d.el.offsetWidth,d.el.offsetHeight,google.ima.ViewMode.NORMAL);this._hasResponse=!0;BPLR.log("Bice da smo ovde",d.config.autoplayInview,!d.isPlayerInView(),d.config.viewability,d.name);BPLR.log("isMidroll","1"===this.parent.currentAdObject.adType);if("1"===this.parent.currentAdObject.adType&&d.midrollPreload)this.parent.paused=
!0;else{if(d.name&&"BPLR.Player"==d.name){if(d.config.autoplayInview&&!d.config.autoplayStickyAdOnly&&!d.isPlayerInView()&&!this.started){d.waitForInViewAdAutoplay=!0;this.parent.paused=!0;return}}else if(d.config.autoplayInview&&!d.isPlayerInView()&&d.config.viewability){this.parent.paused=!0;return}this.started=!0;BPLR.log("GoogleIMA doStartAd 2");this.volume(d.values.muted?0:d.values.volume||0);this.parent.paused=!1;this.adsManager.start()}},onAdEvent:function(d){var c=this.player,b=google.ima.AdEvent.Type,
e=this.currentAd=d.getAd();BPLR.log("GoogleIMA onAdEvent",d.type);BPLR.exLog("GoogleIMA AdEvent",d.type);switch(d.type){case b.LOADED:BPLR.log("GOOGLE IMA AD LOADED","Ad System",e.getAdSystem(),"Advertiser name",e.getAdvertiserName());BPLR.log("Creative Ad ID",e.getCreativeAdId(),"Creative ID",e.getCreativeId());BPLR.log("Creative Trafficking params",e.getTraffickingParameters());BPLR.log("Wrapper Ad IDs",e.getWrapperAdIds(),"Wrapper ad systems",e.getWrapperAdSystems());BPLR.log("Wrapper Creative Ad ID",
e.getWrapperCreativeIds());1<this.currentAd.getAdPodInfo().getTotalAds()&&(this.parent.isPodTag=!0);this.show();BPLR.log("Current ad is linear",e.isLinear(),e.isLinear);if(e.isLinear())BPLR.log("GoogleIMA LOADED setVolume muted",c.values.muted,"volume",c.values.volume),this.checkIsVPAID(e),this.volume(c.values.muted?0:c.values.volume||0);else if(c.currentSrc())c.isPlaying?"1"===this.parent.currentAdObject.adType&&c.paused()&&(this.onContentResumeRequested(),BPLR.log("Call onContentResumeRequested 2")):
(this.parent.adPlayed=!0,this.onContentResumeRequested(),BPLR.log("Call onContentResumeRequested 1"));else{this.onAdError("Google IMA Error. Outstream units do not support non-linear ads");break}BPLR.isMobilePlatform&&Array.prototype.map.call(c.el.getElementsByTagName("video"),function(b){var d=b.play;b.play=function(){BPLR.log("GoogleIMA LOADED play videoNode",b,"videoNode.muted",b.muted,"player.values.muted",c.values.muted);b.muted=c.values.muted;b.play=d;return b.play()}});this.onResize(null);
break;case b.STARTED:BPLR.isIPhone&&c.isFullScreen&&c.toggleFullScreen(!c.isFullScreen);this.parent.onAdStart(this.isVPAID);e.isLinear()&&c.trigger("adDuration",{duration:e.getDuration()});BPLR.event.remove(w.body,"click",this.$f(this.onInteraction));BPLR.log("GoogleIMA STARTED setVolume muted",c.values.muted,"volume",c.values.volume);this.volume(c.values.muted?0:c.values.volume||0);break;case b.IMPRESSION:this.parent.nonceManager&&(BPLR.log("GoogleIMA PAL sendAdImpression"),this.parent.nonceManager.sendAdImpression());
c.showOnAd()&&c.config.autoplayInview&&!c.isPlayerInView()&&(BPLR.log("CALLING OUTSTREAM PAUSE"),this.adsManager.pause());BPLR.isMobilePlatform&&c.showOnAd()&&setTimeout(this.$f(function(){0!=this.currentAd.getDuration()-this.adsManager.getRemainingTime()||c.getAdInProgress()||(BPLR.log("CALLING FADE IN PARENT"),c.fadeInParent())}),1E3);this.parent.onAdImpression();BPLR.log("GoogleIMA IMPRESSION setVolume muted",c.values.muted,"volume",c.values.volume);this.volume(c.values.muted?0:c.values.volume||
0);c.config.delayPreroll&&(this.adsManager.pause(),this.parent.hide(),c.delayPrerollInProgress=!0,this.parent.onContentResumeRequested(),c.progressControl.fadeIn());break;case b.DURATION_CHANGE:this.onResize(null);c.trigger("durationChange");break;case b.PAUSED:c.config.blockAdPause&&!c.pausedOnInteraction?this.adsManager.resume():(BPLR.log("SAD SMO OVDE"),this.parent.paused=!0,c.trigger("pause"),c.trigger("adPause"));BPLR.isMobilePlatform||g.autoplayDesktopSupported||g.isAutoplayDesktopSupported();
break;case b.CLICK:BPLR.isMobilePlatform||g.autoplayDesktopSupported||g.isAutoplayDesktopSupported();this.parent.nonceManager&&(BPLR.log("GoogleIMA PAL sendAdClick"),this.parent.nonceManager.sendAdClick());c.trigger("adClicked");break;case b.RESUMED:this.parent.paused=!1;c.trigger("play");c.trigger("adResume");break;case b.FIRST_QUARTILE:c.trigger("adFirstQuartile");break;case b.MIDPOINT:c.trigger("adMidpoint");break;case b.THIRD_QUARTILE:c.trigger("adThirdQuartile");break;case b.COMPLETE:this.parent.onAdComplete();
break;case b.LOG:d=d.getAdData();d.adError&&BPLR.log("GoogleIMA non-fatal error occurred: "+d.adError.getMessage());break;case b.SKIPPED:this.parent.onAdSkipped();break;case b.ALL_ADS_COMPLETED:case b.USER_CLOSE:var f=this.player.adsManager.currentAdObject,f=f?f.adTags.pod:0;BPLR.log("GoogleIMA",d.type,"getRemainingTime",this.adsManager.getRemainingTime(),"player.waitingForAd",this.player.waitingForAd);BPLR.log("GoogleIMA",d.type,"ad pod",f);if(this.player.waitingForAd&&0<f)BPLR.log("Ignore ALL_ADS_COMPLETED");
else{if(d.type===b.USER_CLOSE)if(.1>=this.adsManager.getRemainingTime())this.parent.onAdComplete();else this.parent.onAdSkipped();if(!this._contentResumeCalled||this.adsManager&&0<this.adsManager.getCuePoints().length&&-1!=this.adsManager.getCuePoints().indexOf(-1))this.onContentResumeRequested();!1===e.isLinear()&&this.parent.reset();this.resetManager()}}},onContentPauseRequested:function(){BPLR.log("GoogleIMA onContentPauseRequested");this._contentResumeCalled=!1;this.parent.onContentPauseRequested()},
onContentResumeRequested:function(d){BPLR.log("GoogleIMA onContentResumeRequested");this._contentResumeCalled=!0;this.parent.onContentResumeRequested()},onAdError:function(d){d=d&&d.getError&&d.getError()||d;BPLR.error("--- BPLRPlayer --- Google IMA Error. ",d);d.getMessage&&d.getMessage()&&BPLR.log("Google IMA Error message",d.getMessage());BPLR.exLog("Google IMA Error.",d);this.player&&this.player.waitForInViewAdAutoplay&&(this.player.waitForInViewAdAutoplay=!1);if(this.adsManager){this.adsManager.removeEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,
this.onContentPauseRequestedFunc);this.adsManager.removeEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequestedFunc);var c=[google.ima.AdEvent.Type.ALL_ADS_COMPLETED,google.ima.AdEvent.Type.COMPLETE,google.ima.AdEvent.Type.LOADED,google.ima.AdEvent.Type.STARTED,google.ima.AdEvent.Type.FIRST_QUARTILE,google.ima.AdEvent.Type.MIDPOINT,google.ima.AdEvent.Type.THIRD_QUARTILE,google.ima.AdEvent.Type.PAUSED,google.ima.AdEvent.Type.RESUMED,google.ima.AdEvent.Type.DURATION_CHANGE,
google.ima.AdEvent.Type.SKIPPED,google.ima.AdEvent.Type.USER_CLOSE,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,google.ima.AdEvent.Type.IMPRESSION,google.ima.AdEvent.Type.LOG];for(b in c)this.adsManager.removeEventListener(c[b],this.onAdEventFunc)}this.isVPAID=!1;if(d&&d.getErrorCode&&901==d.getErrorCode()&&-1==this.adTag.indexOf("brid_vpaidmode"))this.player.config&&this.player.config.id&&"22954"!=this.player.config.id&&(d=google.ima.ImaSdkSettings.VpaidMode,this.resetManager(),this.setVPAIDMode(this.vpaidMode===
d.ENABLED?d.INSECURE:d.ENABLED),this.requestAd(this.adTag+"&brid_vpaidmode="+(this.vpaidMode===d.ENABLED?"secure":"insecure")));else{var b=8888;d&&d.getErrorCode&&(b=d.getErrorCode());this.adsLoader&&(BPLR.log("CALL adsLoader.contentComplete 3"),this.adsLoader.contentComplete());this.parent.onAdError("Google IMA Error. "+d,!1,b)}},onLastSecond:function(){this.player.getAdInProgress()&&this.currentAd&&!this.currentAd.isLinear()&&this.parent.stopNonLinear()},checkIsVPAID:function(d){for(var c in d)d.hasOwnProperty(c)&&
d[c].vpaid&&(this.isVPAID=!0)},stop:function(){this.adsManager&&(BPLR.log("GoogleIMA stop"),this.adsManager.stop())},resetManager:function(){BPLR.log("GoogleIMA resetManager");this.currentAd&&(this.currentAd=null);this.isVPAID=this.parent.hasAdRules=!1;this.adsManager&&(this.adsManager.destroy(),this.adsManager=null)},destroyAdsLoader:function(){BPLR.log("GoogleIMA destroyAdsLoader");this.adsLoader&&(this.adsLoader.destroy(),this.adsLoader=null);this.adDisplayContainer&&(this.adDisplayContainer.destroy(),
this.adDisplayContainer=null,this.adDisplayContainerInitialized=!1)},isLinear:function(){return this.currentAd?this.currentAd.isLinear():null},start:function(){BPLR.log("GoogleIMA start",this._hasResponse);var d=this.player;this.adsManager&&this._hasResponse?(this.volume(d.values.muted?0:d.values.volume||0),this.parent.paused=!1,this.started=!0,this.adsManager.start()):d.waitingForAd=!0},togglePlay:function(d){BPLR.log("GoogleIMA togglePlay",d);this.adsManager&&(d?this.adsManager.resume():this.adsManager.pause())},
duration:function(){return this.currentAd?this.currentAd.getDuration():0},currentTime:function(){return this.adsManager&&this.currentAd?this.currentAd.getDuration()-this.adsManager.getRemainingTime():0},volume:function(d){var c=this.adsManager,b=this.player,e=d;if("undefined"!==typeof d)c&&(!BPLR.isMobilePlatform&&b.config.autoplay&&g.autoplayDesktopSupportedPromise&&!g.autoplayDesktopSupported&&(BPLR.log("GOOGLE IMA SET VOLUME TO 0 DUE TO BROWSER LIMITATION"),e=0,Array.prototype.map.call(this.el.getElementsByTagName("video"),
function(b){BPLR.log("VIDEO ELEMENT",b,"VIDEO ELEMENT src",b.src,"VIDEO ELEMENT currentTime",b.currentTime,"VIDEO ELEMENT ended",b.ended);""!=b.src&&!b.ended&&0<b.currentTime&&(e=d)})),Array.prototype.map.call(this.el.getElementsByTagName("video"),function(b){0<e?b.removeAttribute("muted"):b.setAttribute("muted","true");b.muted=0===e}),BPLR.log("GoogleIMA setVolume val",e),e!=c.getVolume()&&c.setVolume(e));else return c?c.getVolume():0},onResize:function(){var d=this.player,c=d.isFullScreen?google.ima.ViewMode.FULLSCREEN:
google.ima.ViewMode.NORMAL,b=this.currentAd;g.css(this.el,{top:"",bottom:"",left:"",right:""});if(this.adsManager&&b)if(b.isLinear())BPLR.log("GoogleIMA onResize linear offsetWidth",d.playerHolder.el.offsetWidth,"offsetHeight",d.playerHolder.el.offsetHeight),this.adsManager.resize(d.playerHolder.el.offsetWidth,d.playerHolder.el.offsetHeight,c);else{var e=d.isFullScreen?90:45,f=b.getWidth(),b=b.getHeight(),f=1>=f?this.el.offsetWidth-50:f,b=1>=b?100:b;g.css(this,{top:d.playerHolder.el.offsetHeight-
(b+50)-e+"px",bottom:"auto",left:(d.playerHolder.el.offsetWidth-(f+50))/2+"px",right:"auto"});BPLR.log("GoogleIMA onResize non linear ad width",f,"ad height",b);this.adsManager.resize(f+50,b+50,c)}},supportsAdTag:function(d){BPLR.log("GoogleIMA supportsAdTag",d,BPLR.Util.adBlockerEnabled);return-1!==d.indexOf("brid_parser=ima")?!0:-1!==d.indexOf("brid_parser=brid")?!1:(g.validateURL(d)||-1!==d.indexOf("<VAST")&&-1!==d.indexOf("</VAST>"))&&!BPLR.Util.adBlockerEnabled}});BPLR.VAST=BPLR.Abstract.extend({closeTimeout:null,
hasAdRules:!1,isVPAID:!1,jsLoaded:!1,cssLoaded:!1,_hasResponse:!1,adTimeout:15,pbTechInitialized:!1,init:function c(b,e){c.base.call(this,b,e);this.name="BPLR.VAST";this.el=e.container;this.parent=e.wrapper;"undefined"===typeof BPLR.AdSDK?(e="",g.useVersioning(b.config.Url.servicePlugins)&&(e="parser/"+BPLR.pv.plugins.parser.version+"/"),BPLR.Loader.load("js",b.config.Url.servicePlugins+"/"+b.config.Url.plugins+e+"brid.parser.min.js",this.$f(this.onJSLoaded),null,this)):this.triggerReady()},onJSLoaded:function(){setTimeout(this.$f(function(){"undefined"!=
typeof BPLR.AdSDK?this.isReady||this.triggerReady():(this.error=!0,this.parent.onAdError("BPLR VAST ERROR. BPLR VAST SDK load failed.",!0))}),0)},setupAdsLoader:function(){BPLR.log("BPLR.VAST setupAdsLoader");if(!this.adsManager){try{var c=this.adsManager=new BPLR.AdSDK.AdsManager(this.player,{},this.el)}catch(b){BPLR.error("BPLR VAST ERROR. BPLR VAST SDK could not be initialized",b);this.error=!0;this.parent.onAdError("BPLR VAST ERROR. BPLR VAST SDK could not be initialized",!0);return}this.player&&
this.player.tech&&this.player.tech.support.adManagement?this.hide():(c.add("vast.adClickThru",this.$f(this.onClickThru)),c.add("vast.adEnd",this.$f(this.onAdEnd)),c.add("vast.adStart",this.$f(this.onAdStart)),c.add("vast.contentPauseRequested",this.$f(this.onContentPauseRequested)),c.add("vast.contentResumeRequested",this.$f(this.onContentResumeRequested)),c.add("vast.adImpression",this.$f(this.onAdImpression)),c.add("vast.adVideoStart",this.$f(this.onAdVideoStart)),c.add("vast.adSkip",this.$f(this.onAdSkiped)),
c.add("vast.adError",this.$f(this.onAdError)),c.add("vast.adDurationChange",this.$f(this.onAdDurationChange)),c.add("vast.adPause",this.$f(this.onAdPause)),c.add("vast.adResume",this.$f(this.onAdResume)),c.add("vast.adVideoComplete",this.$f(this.onAdComplete)),c.add("vast.selected3rdParty",this.$f(this.on3rdPartySelected)),c.add(["vast.firstQuartile","vast.midpoint","vast.thirdQuartile"],this.$f(function(b){switch(b.type){case "vast.firstQuartile":this.player.trigger("adFirstQuartile");break;case "vast.midpoint":this.player.trigger("adMidpoint");
break;case "vast.thirdQuartile":this.player.trigger("adThirdQuartile")}})),this.player.add("userInteraction",this.$f(this.onUserInteraction)),this.player.add("lastSecond",this.$f(this.onLastSecond)))}},contentComplete:function(){},requestAd:function(c){var b=w.BPLRIframeBurst?v.top:v;0<c.indexOf("//googleads")&&10>c.indexOf("//googleads")&&(c="https://ima3vpaid.appspot.com/?adTagUrl="+c+"&type=js");if(-1!=c.toLowerCase().indexOf("brid_adtimeout")){var e=g.queryStringToObj(c);BPLR.log("VAST requestAd params",
e);this.adTimeout=e.brid_adtimeout||this.adTimeout;c=g.removeParam("brid_adtimeout",c)}c=g.removeParam("brid_parser",c);0<c.indexOf("pubads")&&10>c.indexOf("pubads")&&(c=g.removeParam("impl",c),c=g.replaceParam("output","xml_vast4",c),c+=this.player.config.autoplay?"&vpa=auto":"&vpa=click",c+=this.player.muted()?"&vpmute=1":"&vpmute=0",c+=g.addAfszv(this.player.el.offsetWidth,this.player.el.offsetHeight),b.googleToken&&b.googleToken[4]&&""!=b.googleToken[4]&&(c=c+"&jar="+b.googleToken[4]),c+=g.isAmp()?
"&is_amp=1":"&is_amp=0",c=c+"&scor="+Math.floor(4503599627370496*Math.random()));BPLR.exLog("BPLR.VAST requestAd",c);this.adsManager||this.setupAdsLoader();this.show();this.adUnit=null;this._hasResponse=!1;this.adsManager.config.adCancelTimeout=1E3*this.adTimeout;this.adsManager.requestAd(c,this.$f(this.onAdResponse))},onAdResponse:function(){var c=this.player,b=this.parent.currentAdObject,e=b.adTags.pod,f=b.adTags.priority-1;c.fireTicks&&0==b.adType&&0==e&&(c.timer.tick("adresponse"),c.trigger("tick",
{tickType:"ar",tickTime:c.timer.ticks.adresponse,wp:f}));BPLR.exLog("BPLR.VAST onAdResponse");this._hasResponse=!0;this.show();c.canAutoplay()||c.userInteracted?(this.pbTechInitialized=!0,this.doStartAd()):BPLR.event.add(w.body,"click",this.$f(this.onInteraction,this.id),!0)},onUserInteraction:function(){this.player.remove("userInteraction",this.$f(this.onUserInteraction));BPLR.log("BPLR.VAST onUserInteraction pbTechInitialized",this.pbTechInitialized,"userInteracted",this.player.userInteracted);
this.parent.currentAdsManager&&"GoogleIMA"==this.parent.currentAdsManager.name||this.player.getAdInProgress()||(this.adsManager||this.setupAdsLoader(),this.pbTechInitialized||(this.pbTechInitialized=!0,this.adsManager.initializePlaybackTech()))},onInteraction:function(){BPLR.event.remove(w.body,"click",this.$f(this.onInteraction));this.onUserInteraction();this.doStartAd()},doStartAd:function(){var c=this.player;BPLR.log("BPLR.VAST doStartAd");this.parent.doStartAdCalled=!0;if("1"===this.parent.currentAdObject.adType&&
c.midrollPreload)this.parent.paused=!0;else{if(c.name&&"BPLR.Player"==c.name){if(c.config.autoplayInview&&!c.config.autoplayStickyAdOnly&&!c.isPlayerInView()&&!this.started){c.waitForInViewAdAutoplay=!0;this.parent.paused=!0;return}}else if(c.config.autoplayInview&&!c.isPlayerInView()&&c.config.viewability){this.parent.paused=!0;return}this.started=!0;this.parent.paused=!1;this.adUnit=this.adsManager.playAd();BPLR.log("\tsetAdVolume VAST doStartAd");this.adsManager.setAdVolume(this.player.values.muted?
0:this.player.values.volume);this.onResize();this.player.showOnAd()}},onAdStart:function(){BPLR.exLog("BPLR.VAST onAdStart");this.adsManager.isVPAID&&!this.adsManager.adManager.tech._adUnit._creative.getAdLinear()&&(BPLR.isMobilePlatform&&g.isIOS()||(this.adsManager.adManager.playbackTech.el.src=""),this.adsManager.resize(this.player.el.offsetHeight-150-40,0,this.player.el.offsetWidth,150,"normal"),this.player.adInProgress=!1,this.parent.adPlayed=!0,this.onContentResumeRequested());BPLR.event.remove(w.body,
"click",this.$f(this.onInteraction));this.adUnit=this.adsManager.adUnit;if(this.isLinear()||this.player.currentSrc())BPLR.log("VAST onAdStart setVolume muted",this.player.values.muted,"volume",this.player.values.volume),BPLR.log("\tsetAdVolume VAST onAdStart"),this.adsManager.setAdVolume(this.player.values.muted?0:this.player.values.volume),this.parent.onAdStart(this.adsManager.isVPAID);else this.onAdError({data:"Outstream units do not support non-linear ads"})},onAdImpression:function(){var c=this.player;
this.adUnit||(this.adUnit=this.adsManager.adUnit);c.showOnAd()&&c.config.autoplayInview&&!c.isPlayerInView()&&this.adUnit.pauseAd();BPLR.log("VAST onAdImpression setVolume muted",this.player.values.muted,"volume",this.player.values.volume);BPLR.log("\tsetAdVolume VAST onAdImpression");this.adsManager.setAdVolume(c.values.muted?0:c.values.volume);this.onResize();this.parent.onAdImpression()},onAdVideoStart:function(){this.onResize()},onAdComplete:function(){BPLR.log("BPLR.VAST onAdComplete");BPLR.exLog("BPLR.VAST onAdComplete");
this.parent.onAdComplete()},onAdSkiped:function(){this.parent.adSkipped=!0;this.parent.onAdSkipped();BPLR.exLog("BPLR.VAST onAdSkiped");BPLR.log("BPLR.VAST onAdSkiped")},onAdEnd:function(){BPLR.exLog("BPLR.VAST onAdEnd");BPLR.log("BPLR.VAST onAdEnd")},onContentPauseRequested:function(){this.parent.onContentPauseRequested()},onContentResumeRequested:function(){BPLR.log("BPLR.VAST onContentResumeRequested waitForPlaylistEnd",this.adsManager.waitForPlaylistEnd);this.adsManager.waitForPlaylistEnd||(0==
this.isLinear()&&(this.parent.adPlayed=!0),this.parent.onContentResumeRequested())},onAdPause:function(){BPLR.exLog("BPLR.VAST onAdPause");var c=this.player;c.config.blockAdPause&&!c.pausedOnInteraction?this.adUnit.resumeAd():(this.parent.paused=!0,c.trigger("pause"),c.trigger("adPause"))},onClickThru:function(){BPLR.exLog("BPLR.VAST onClickThru");this.player.trigger("adClicked")},onAdResume:function(){BPLR.exLog("BPLR.VAST onAdResume");this.parent.paused=!1;this.adsManager.isVPAID||this.player.trigger("play");
this.player.trigger("adResume")},onAdDurationChange:function(){this.player.trigger("durationchange")},on3rdPartySelected:function(){this.parent.thirdParty=!0},onAdError:function(c){this.adsManager.waitForPlaylistEnd||(c=c.data?c.data.error:"",BPLR.exLog("BPLR.VAST onAdError",c),BPLR.log("BPLR.VAST onAdError",c),this.parent.onAdError("BPLR.VAST onAdError "+c,!1,c&&c.code?c.code:8888))},stop:function(){this.adsManager&&this.adsManager.stopAd()},onLastSecond:function(){this.adsManager&&this.adUnit&&
!this.isLinear()&&this.parent.stopNonLinear()},resetManager:function(){this.adUnit=null;BPLR.log("BPLR.VAST resetManager");this.adsManager&&this.adsManager.reset()},destroyAdsLoader:function(){BPLR.log("AdSDK destroyAdsLoader");this.pbTechInitialized=!1;this.adsManager&&(this.adsManager.destroyAdsLoader(),this.adsManager.destroy(),this.adsManager=null)},isLinear:function(){return this.adUnit?this.adsManager.isLinear():null},start:function(){BPLR.log("BPLR.VAST start adsManager",this.adsManager,"_hasResponse",
this._hasResponse);this.adsManager&&this._hasResponse?(this.adsManager.playAd(),BPLR.log("\tsetAdVolume VAST start"),this.adsManager.setAdVolume(this.player.values.muted?0:this.player.values.volume),this.parent.paused=!1):this.player.waitingForAd=!0},togglePlay:function(c){BPLR.log("BPLR.VAST togglePlay",c);this.adsManager&&this.adUnit&&(c?this.adUnit.resumeAd():this.adUnit.pauseAd())},duration:function(){return this.adsManager?this.adsManager.getAdDuration()||-1:0},currentTime:function(){return this.adsManager?
this.adsManager.getAdCurrentTime()||0:0},volume:function(c){var b=this.adsManager;if("undefined"!==typeof c)b&&(BPLR.log("\tsetAdVolume VAST volume"),b.setAdVolume(c));else return b?b.getAdVolume():0},hide:function(){this.el&&g.css(this.el,{display:"none"})},show:function(){this.el&&g.css(this.el,{display:"block"})},onResize:function(){if(this.player.getAdInProgress()){var c=this.player,b=c.isFullScreen?"fullscreen":"normal";g.css(this.el,{top:"",bottom:"",left:"",right:""});if(this.adsManager.isLinear()&&
this.adUnit)BPLR.log("VAST onResize isLinear",c.playerHolder.el.offsetWidth,c.playerHolder.el.offsetHeight),this.adsManager.resize(0,0,c.playerHolder.el.offsetWidth,c.playerHolder.el.offsetHeight,b);else if(this.adUnit){var e=c.isFullScreen?90:45,f=this.adUnit.getWidth()||0,h=this.adUnit.getHeight()||0,f=0>=f?this.el.offsetWidth-50:f,h=0>=h?100:h;this.adsManager.resize(c.playerHolder.el.offsetHeight-h-e,(c.playerHolder.el.offsetWidth-f)/2,f,h,b)}}},supportsAdTag:function(c){BPLR.log("BPLR.VAST supportsAdTag",
c,BPLR.Util.adBlockerEnabled);return-1!==c.indexOf("brid_parser=ima")?!1:-1!==c.indexOf("brid_parser=brid")?!0:(g.validateURL(c)||-1!==c.indexOf("<VAST")&&-1!==c.indexOf("</VAST>"))&&(-1===c.indexOf("//googleads")&&-1===c.indexOf("21760922134")||BPLR.Util.adBlockerEnabled)}});BPLR.BannerAd=BPLR.Abstract.extend({default:{adRequestTimeout:15E3,adDuration:15},init:function b(e,f){b.base.call(this,e,f);this.el=f.container;this.parent=f.wrapper;this.name="BannerAd";this.closeButtonInterval=null;this.triggerReady()},
iframeBannerResizeCallback:function(b){var e=w.BPLRIframeBurst?v.top:v,f=this.iframeBanner;if("bannerResize"==b.data.event&&(f.style.width=b.data.w+"px",f.style.height=b.data.h+"px",BPLR.event.remove(e,"message",this.$f(this.iframeBannerResizeCallback)),BPLR.log("BannerAd setting iframe size to",b.data.w,b.data.h),50<b.data.w&&50<b.data.h))this.onAdLoaded()},requestAd:function(b){function e(){h.anyad.contains(h.ad)||!g.isChrome()||h.player.anyAdMode||h.anyad.appendChild(h.ad);var b=h.ad.getElementsByTagName("iframe");
BPLR.log("BannerAd checkForIframe iframes",b);if(0<b.length)h.adLoadTimeout=setTimeout(h.$f(h.onAdLoadError),h.config.adRequestTimeout),(this.adiFrame=b[b.length-1])&&BPLR.event.once(this.adiFrame,"load",h.$f(h.onAdLoaded));else if(0<h.ad.getElementsByTagName("img").length||0<h.ad.getElementsByTagName("a").length)h.onAdLoaded();else if(100>=p)p++,setTimeout(e,50);else h.onAdLoadError()}var f=w.BPLRIframeBurst?v.top:v;b=b.split("<|>");var h=this,p=0,u;this.config.adDuration=b[1]?parseInt(b[1]):0;b=
b[0];var m=/\.display\('(.*)'\)/g.exec(b),l=Math.floor(Math.random()*Math.floor(1E3));m&&(b=b.split(m[1]).join(m[1]+"-"+l),BPLR.log("BannerAd modifying adTag div id",m[1]+"-"+l));this.player.showOnAd()&&"inslide"==this.player.config.type&&(this.player.config.use_iframe_for_banners=!0);BPLR.log("BannerAd requestAd",b,"adDuration",this.config.adDuration,"use iframe",!!this.player.config.use_iframe_for_banners);if(this.player.config.use_iframe_for_banners){this.ad=g.createElement("div",{className:"bplr-banner-ad"});
var r=this.iframeBanner=w.createElement("iframe");var n="<body><style>html,body{margin:0;padding:0}</style><script>window.onload=function(){var cnt=0;function checkIframeSizes(){var iframes=document.querySelectorAll('iframe');iframes.forEach(function(i){if(i.clientWidth!=0&&i.clientHeight!=0){window.parent.postMessage({event:'bannerResize',w:i.clientWidth,h:i.clientHeight},'*');clearInterval(th);}});if(cnt++>=300)clearInterval(th);}var th=setInterval(checkIframeSizes,50);};\x3c/script>"+b+"</body>";
this.ad.appendChild(r);r.style.display="block";r.style.border="0";r.style.width="0px";r.style.height="0px";this.adLoadTimeout=setTimeout(this.$f(this.onAdLoadError),this.config.adRequestTimeout);BPLR.event.add(f,"message",this.$f(this.iframeBannerResizeCallback))}else{b=b.replace("googletag.cmd.push","googletag.cmd=googletag.cmd||[];googletag.cmd.push");var q="";this.originalDW=w.write;w.write=this.$f(function(b){q+=b;/<[a-z][\s\S]*>/i.test(q)&&(u=g.createElement("div",{innerHTML:""}),u.innerHTML=
q,h.ad.appendChild(u),q="",h.executeJS(u))});this.ad=g.createElement("div",{className:"bplr-banner-ad",innerHTML:"<div>"+b+"</div>"})}this.anyad=g.createElement("div",{className:"bplr-banner-anyad"});"inglide"==this.player.positionType&&this.player.SlideInView&&this.player.SlideInView.resizeAnyAd();this.player.config.banner_timer&&(this.anyadInfo=g.createElement("div",{className:"bplr-banner-anyad-info"}),this.player.playerCloseButton&&this.player.playerCloseButton.buttonConfig.position&&"top-left"==
this.player.playerCloseButton.buttonConfig.position&&g.css(this.anyadInfo,{"margin-left":"25px"}),this.anyad.insertBefore(this.anyadInfo,this.anyad.firstChild));this.player.anyAdMode=this.player.config.anyAd&&!this.player.isFullScreen;this.player.anyAdMode?(this.player.el.insertBefore(this.anyad,this.player.firstChild),BPLR.Util.addResizeListener(this.ad,this.$f(this.onAnyAdResized))):this.player.playerHolder.el.insertBefore(this.anyad,this.player.firstChild);this.anyad.appendChild(this.ad);this.player.config.use_iframe_for_banners?
(r.contentWindow.document.open(),r.contentWindow.document.write(n),r.contentWindow.document.close()):(this.executeJS(this.ad),setTimeout(e,50))},executeJS:function(b){function e(b,e,g){b.getAttribute(g)&&e.setAttribute(g,b.getAttribute(g)||"")}b=[].slice.call(b.getElementsByTagName("script"));0<b.length&&b.slice(0).map(function(b){var f=g.createElement("script");f.innerHTML=b.innerHTML;e(b,f,"src");e(b,f,"type");e(b,f,"async");e(b,f,"id");b.parentNode&&b.parentNode.insertBefore(f,b);b.parentNode&&
b.parentNode.removeChild(b)})},onAdLoaded:function(){BPLR.log("BannerAd onAdLoaded");this.originalDW&&(w.write=this.originalDW);var b=this.player;b.bannerMode=!0;this.adLoadTimeout&&clearTimeout(this.adLoadTimeout);b.config.enable_close_button||(this.close=new BPLR.Close(b,{name:"Close"}),this.close.add("close",this.$f(this.onAdEnd)),this.close.addClass("bplr-close-banner"));this.adBannerBar=g.createElement("div",{className:"bplr-banner-ad-bar"});this.el.appendChild(this.adBannerBar);this.adInfo=
g.createElement("div",{className:"bplr-banner-ad-info",innerHTML:"Advertisement"});this.adBannerBar.appendChild(this.adInfo);b.currentSrc()?g.css(this.el,{"background-color":"#000"}):g.css(b.el,{"background-color":"transparent"});b.controls&&b.controls.hide();b.progressControl&&b.progressControl.hide();this.parent.paused=!0;this.parent.onAdStart();this.player.anyAdMode&&(this.onAnyAdResized(),"inglide"==this.player.positionType&&this.player.SlideInView&&this.player.SlideInView.resizeAnyAd());this.parent.onAdImpression();
this.parent.onContentPauseRequested();if(b.name&&"BPLR.Player"==b.name){if(b.config.autoplayInview&&!b.isPlayerInView()&&"inglide"!=b.positionType){this.waitingForStart=b.waitForInViewAdAutoplay=!0;return}}else{if(b.showOnAd()&&b.config.autoplayInview&&!b.isPlayerInView()){this.waitingForStart=!0;return}this.parent.paused=!1}this.initTimeouts()},start:function(){BPLR.exLog("BannerAd start");this.waitingForStart&&this.initTimeouts()},stop:function(){this.onAdEnd()},initTimeouts:function(){this.waitingForStart=
!1;this.config.adDuration&&(BPLR.log("BannerAd onAdLoaded set ad timeout",this.config.adDuration),this.durationTimeout=setTimeout(this.$f(this.onAdEnd),1E3*this.config.adDuration),this.elapsedTime=0,this.player.config.banner_timer&&(this.timerInterval=setInterval(this.$f(function(){this.elapsedTime++;(this.anyadInfo||this.adInfo).innerHTML="Ad: "+(this.config.adDuration-this.elapsedTime)+"s"}),1E3)))},onAdEnd:function(){var b=this.player;BPLR.log("BannerAd onAdEnd");this.parent.onAdComplete();this.resetManager();
b.currentSrc()&&g.css(this.el,{"background-color":"transparent"});b.currentSrc()&&(b.controls&&b.controls.show(),b.progressControl&&b.progressControl.show());this.parent.onContentResumeRequested()},onAdLoadError:function(){BPLR.log("BannerAd onAdLoadError");this.originalDW&&(w.write=this.originalDW);this.resetManager();this.parent.onAdError("Banner Ad Load Timeout")},isLinear:function(){return!0},resetManager:function(){this.player.bannerMode=!1;BPLR.event.remove(w.BPLRIframeBurst?v.top:v,"message",
this.$f(this.iframeBannerResizeCallback));this.adiFrame&&(BPLR.event.remove(this.adiFrame,"load",this.$f(this.onAdLoaded)),this.adiFrame=null);this.closeButtonInterval&&clearInterval(this.closeButtonInterval);this.timerInterval&&clearInterval(this.timerInterval);this.durationTimeout&&clearInterval(this.durationTimeout);this.adLoadTimeout&&clearInterval(this.adLoadTimeout);this.close&&(this.close.destroy(),this.close=null);this.ad&&this.ad.parentNode&&(this.player.anyAdMode&&(BPLR.log("BannerAd AnyAd remove ResizeListener"),
BPLR.Util.removeResizeListener(this.ad,this.$f(this.onAnyAdResized))),this.anyad.parentNode&&this.anyad.parentNode.removeChild(this.anyad),this.player.anyAdMode&&(this.player.playerHolder.el.style.display="",BPLR.log("BannerAd AnyAd reverting player size",this.player.positionType,this.preAnyadSize),this.preAnyadSize&&(this.player.el.style.width=this.preAnyadSize.width+"px",this.player.el.style.height=this.preAnyadSize.height+"px"),this.player.resize(),this.preAnyadSize=null,this.player.removeClass("bplr-any-ad"),
this.player.trigger("anyadFinished"),this.player.onResize()),this.ad=null);this.adInfo&&this.adInfo.parentNode&&(this.adBannerBar.removeChild(this.adInfo),this.adInfo=null);this.adBannerBar&&this.adBannerBar.parentNode&&(this.el.removeChild(this.adBannerBar),this.adBannerBar=null)},setupAdsLoader:function(){},contentComplete:function(){},onAnyAdResized:function(){this.player.trigger("playerresize")},onResize:function(b){if(this.player.getAdInProgress()&&this.player.anyAdMode){var e=this.player;b=
this.anyad;if(300==e.el.clientWidth&&250<=e.el.clientHeight&&270>=e.el.clientHeight&&150<=this.ad.clientWidth&&170>=this.ad.clientWidth)return BPLR.log("Responsive or iframe banner - do not resize"),!1;BPLR.log("BannerAd AnyAd onResize player",e.el.clientWidth,e.el.clientHeight,"ad",this.ad.clientWidth,this.ad.clientHeight);this.preAnyadSize||(this.preAnyadSize={width:e.el.clientWidth,height:e.el.clientHeight},e.currentSrc()||0!=this.parent.currentAdObject.adTags.pod||(e.el.style.opacity=0),BPLR.log("BannerAd AnyAd preAnyadSize",
this.preAnyadSize));b.style.width=this.ad.clientWidth+"px";b.style.height=this.ad.clientHeight+"px";e.playerHolder.el.style.display="none";e.el.style.width=b.style.width;e.el.style.height=b.style.height;e.currentSrc()||(clearTimeout(this.showAnyAdTimeout),this.showAnyAdTimeout=setTimeout(function(){e.el.style.opacity=1},200));g.addClass(this.ad,"bplr-banner-ad-no");g.removeClass(this.ad,"bplr-banner-ad");e.addClass("bplr-any-ad");e.SlideInView&&e.SlideInView.repositionCloseButton();e.repositionCloseButton&&
e.repositionCloseButton();e.parentEl&&"inslide"==this.player.config.type&&(e.parentEl.style.width=e.el.style.width,e.parentEl.style.height=e.el.style.height)}},hide:function(){this.el&&g.css(this.el,{display:"none"})},show:function(){this.el&&g.css(this.el,{display:"block"})},supportsAdTag:function(b){return!this.player.config.anyAd&&this.player.el&&this.player.el.clientHeight&&250>this.player.el.clientHeight?(BPLR.error("--- BPLRPlayer --- Banners are not supported on small player sizes"),!1):!g.validateURL(b)&&
!BPLR.Util.adBlockerEnabled},togglePlay:function(b){BPLR.log("BannerAd togglePlay",b);this.waitingForStart&&b&&this.initTimeouts();this.parent.paused=!b;b?this.player.trigger("play"):this.player.trigger("pause")},duration:function(){return this.config.adDuration||0},currentTime:function(){return 0},volume:function(){return this.player.values.volume}});v.$bp.plugin("bridgima",function(b){b=b||this;b.isReady?b.addChild(new v.$bp.Advertising(b,config)):v.$bp.Util.merge(b.config.children,{Advertising:{}})});
F.trigger(w,"bridpluginloaded")})(window,document);
